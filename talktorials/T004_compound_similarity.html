<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="T004 · Ligand-based screening: compound similarity" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://projects.volkamerlab.org/teachopencadd/talktorials/T004_compound_similarity.html" />
<meta property="og:site_name" content="TeachOpenCADD" />
<meta property="og:description" content="Note: This talktorial is a part of TeachOpenCADD, a platform that aims to teach domain-specific skills and to provide pipeline templates as starting points for research projects. Authors: Andrea Morger, 2017-2020, Volkamer lab, Charité, Franziska Fritz, CADD seminar, 2018, Charité/FU Berlin, Yong..." />
<meta property="og:image" content="https://raw.githubusercontent.com/volkamerlab/teachopencadd/master/docs/_static/images/TeachOpenCADD_topics.png" />
<meta property="og:image:alt" content="TeachOpenCADD" />
<meta name="description" content="Note: This talktorial is a part of TeachOpenCADD, a platform that aims to teach domain-specific skills and to provide pipeline templates as starting points for research projects. Authors: Andrea Morger, 2017-2020, Volkamer lab, Charité, Franziska Fritz, CADD seminar, 2018, Charité/FU Berlin, Yong..." />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#2196f3">
  <script src="../_static/javascripts/modernizr.js"></script>
  
    <script async src="../_static/cookieconsent.min.js"></script>
    <script>
        window.addEventListener("load", function(){
        window.cookieconsent.initialise({
            "palette": {
            "popup": {
                "background": "#f0f0f0",
                "text": "#999"
            },
            "button": {
                "text": "#fff",
                "background": "#009688"
            }
            },
            "theme": "classic"
        })});
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q6ZE82CNZB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Q6ZE82CNZB');
    </script>
  
    <link rel="apple-touch-icon" href="../_static/images/apple-icon-152x152.png"/>
  
  
    <title>T004 · Ligand-based screening: compound similarity &#8212; TeachOpenCADD 0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="T005 · Compound clustering" href="T005_compound_clustering.html" />
    <link rel="prev" title="T003 · Molecular filtering: unwanted substructures" href="T003_compound_unwanted_substructures.html" />
  
    <link rel="apple-touch-icon" href="../_static/images/apple-icon-152x152.png"/>
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=teal data-md-color-accent=cyan>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#talktorials/T004_compound_similarity" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="TeachOpenCADD 0 documentation"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">TeachOpenCADD</span>
          <span class="md-header-nav__topic"> T004 · Ligand-based screening: compound similarity </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/volkamerlab/teachopencadd/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    TeachOpenCADD
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../talktorials.html" class="md-tabs__link">Our talktorials</a></li>
            
            <li class="md-tabs__item"><a href="../installing.html" class="md-tabs__link">Run locally</a></li>
            
            <li class="md-tabs__item"><a href="../contribute.html" class="md-tabs__link">Development</a></li>
            
            <li class="md-tabs__item"><a href="../contact.html" class="md-tabs__link">Contact</a></li>
            
            <li class="md-tabs__item"><a href="../citation.html" class="md-tabs__link">Citation</a></li>
          <li class="md-tabs__item"><a href="../all_talktorials.html" class="md-tabs__link">Complete list of talktorials</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="TeachOpenCADD 0 documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    <a href="../index.html"
       title="TeachOpenCADD 0 documentation">TeachOpenCADD</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/volkamerlab/teachopencadd/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    TeachOpenCADD
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Our talktorials</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../all_talktorials.html" class="md-nav__link">Complete list of talktorials</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html" class="md-nav__link">Talktorials by collection</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html#edition-2019-jcim" class="md-nav__link">Edition 2019 - JCIM</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html#edition-2021" class="md-nav__link">Edition 2021</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html#ligand-based-cheminformatics" class="md-nav__link">Ligand-based cheminformatics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html#structural-biology" class="md-nav__link">Structural biology</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html#online-apis-servers" class="md-nav__link">Online APIs/servers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html#kinase-similarity" class="md-nav__link">Kinase similarity</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Run locally</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installing.html" class="md-nav__link">Installing</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Development</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../contribute.html" class="md-nav__link">For contributors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../api.html" class="md-nav__link">API Documentation</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">About TeachOpenCADD</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../contact.html" class="md-nav__link">Contact</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../acknowledgments.html" class="md-nav__link">Acknowledgments</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../citation.html" class="md-nav__link">Citation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../license.html" class="md-nav__link">License</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../funding.html" class="md-nav__link">Funding</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">External resources</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../external_dependencies.html" class="md-nav__link">Packages and webservers used in TeachOpenCADD</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../external_tutorials_collections.html" class="md-nav__link">External tutorials and collections</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#talktorials-t004-compound-similarity--page-root" class="md-nav__link">T004 · Ligand-based screening: compound similarity</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Aim-of-this-talktorial" class="md-nav__link">Aim of this talktorial</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Contents-in-Theory" class="md-nav__link">Contents in <em>Theory</em></a>
        </li>
        <li class="md-nav__item"><a href="#Contents-in-Practical" class="md-nav__link">Contents in <em>Practical</em></a>
        </li>
        <li class="md-nav__item"><a href="#References" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Theory" class="md-nav__link">Theory</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Molecular-similarity" class="md-nav__link">Molecular similarity</a>
        </li>
        <li class="md-nav__item"><a href="#Molecular-descriptors" class="md-nav__link">Molecular descriptors</a>
        </li>
        <li class="md-nav__item"><a href="#Molecular-fingerprints" class="md-nav__link">Molecular fingerprints</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Substructure-based-fingerprints" class="md-nav__link">Substructure-based fingerprints</a>
        </li>
        <li class="md-nav__item"><a href="#MACCS-fingerprints" class="md-nav__link">MACCS fingerprints</a>
        </li>
        <li class="md-nav__item"><a href="#Morgan-fingerprints-and-circular-fingerprints" class="md-nav__link">Morgan fingerprints and circular fingerprints</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Molecular-similarity-measures" class="md-nav__link">Molecular similarity measures</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Tanimoto-coefficient" class="md-nav__link">Tanimoto coefficient</a>
        </li>
        <li class="md-nav__item"><a href="#Dice-coefficient" class="md-nav__link">Dice coefficient</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Virtual-screening" class="md-nav__link">Virtual screening</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Virtual-screening-using-similarity-search" class="md-nav__link">Virtual screening using similarity search</a>
        </li>
        <li class="md-nav__item"><a href="#Enrichment-plots" class="md-nav__link">Enrichment plots</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Practical" class="md-nav__link">Practical</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Import-and-draw-molecules" class="md-nav__link">Import and draw molecules</a>
        </li>
        <li class="md-nav__item"><a href="#Calculate-molecular-descriptors" class="md-nav__link">Calculate molecular descriptors</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#1D-molecular-descriptors:-Molecular-weight" class="md-nav__link">1D molecular descriptors: Molecular weight</a>
        </li>
        <li class="md-nav__item"><a href="#2D-molecular-descriptors:-MACCS-fingerprint" class="md-nav__link">2D molecular descriptors: MACCS fingerprint</a>
        </li>
        <li class="md-nav__item"><a href="#2D-molecular-descriptors:-Morgan-fingerprint" class="md-nav__link">2D molecular descriptors: Morgan fingerprint</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Calculate-molecular-similarity" class="md-nav__link">Calculate molecular similarity</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#MACCS-fingerprints:-Tanimoto-similarity-and-Dice-similarity" class="md-nav__link">MACCS fingerprints: Tanimoto similarity and Dice similarity</a>
        </li>
        <li class="md-nav__item"><a href="#Morgan-fingerprints:-Tanimoto-similarity-and-Dice-similarity" class="md-nav__link">Morgan fingerprints: Tanimoto similarity and Dice similarity</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#id1" class="md-nav__link">Virtual screening using similarity search</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Compare-query-molecule-to-all-molecules-in-the-data-set" class="md-nav__link">Compare query molecule to all molecules in the data set</a>
        </li>
        <li class="md-nav__item"><a href="#Distribution-of-similarity-values" class="md-nav__link">Distribution of similarity values</a>
        </li>
        <li class="md-nav__item"><a href="#Visualize-most-similar-molecules" class="md-nav__link">Visualize most similar molecules</a>
        </li>
        <li class="md-nav__item"><a href="#Generate-enrichment-plots" class="md-nav__link">Generate enrichment plots</a>
        </li>
        <li class="md-nav__item"><a href="#Calculate-enrichment-factors" class="md-nav__link">Calculate enrichment factors</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Discussion" class="md-nav__link">Discussion</a>
        </li>
        <li class="md-nav__item"><a href="#Quiz" class="md-nav__link">Quiz</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/talktorials/T004_compound_similarity.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="T004-·-Ligand-based-screening:-compound-similarity">
<h1 id="talktorials-t004-compound-similarity--page-root">T004 · Ligand-based screening: compound similarity<a class="headerlink" href="#talktorials-t004-compound-similarity--page-root" title="Permalink to this heading">¶</a></h1>
<p><strong>Note:</strong> This talktorial is a part of TeachOpenCADD, a platform that aims to teach domain-specific skills and to provide pipeline templates as starting points for research projects.</p>
<p>Authors:</p>
<ul class="simple">
<li><p>Andrea Morger, 2017-2020, <a class="reference external" href="https://volkamerlab.org/">Volkamer lab</a>, Charité</p></li>
<li><p>Franziska Fritz, CADD seminar, 2018, Charité/FU Berlin</p></li>
<li><p>Yonghui Chen, 2019-2020, <a class="reference external" href="https://volkamerlab.org/">Volkamer lab</a>, Charité</p></li>
<li><p>Dominique Sydow, 2018-2020, <a class="reference external" href="https://volkamerlab.org/">Volkamer lab</a>, Charité</p></li>
</ul>
<p><strong>Talktorial T004</strong>: This talktorial is part of the TeachOpenCADD pipeline described in the <a class="reference external" href="https://jcheminf.biomedcentral.com/articles/10.1186/s13321-019-0351-x">first TeachOpenCADD paper</a>, comprising of <strong>talktorials T001-T010</strong>.</p>
<section id="Aim-of-this-talktorial">
<h2 id="Aim-of-this-talktorial">Aim of this talktorial<a class="headerlink" href="#Aim-of-this-talktorial" title="Permalink to this heading">¶</a></h2>
<p>In this talktorial, we get familiar with different approaches to encode (descriptors, fingerprints) and compare (similarity measures) molecules. Furthermore, we perform a virtual screening in the form of a similarity search for the EGFR inhibitor Gefitinib against our dataset of EGFR-tested molecules from the ChEMBL database filtered by Lipinski’s rule of five (see <strong>Talktorial T002</strong>).</p>
<section id="Contents-in-Theory">
<h3 id="Contents-in-Theory">Contents in <em>Theory</em><a class="headerlink" href="#Contents-in-Theory" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Molecular similarity</p></li>
<li><p>Molecular descriptors</p></li>
<li><p>Molecular fingerprints</p>
<ul>
<li><p>Substructure-based fingerprints</p></li>
<li><p>MACCS fingerprints</p></li>
<li><p>Morgan fingerprints and circular fingerprints</p></li>
</ul>
</li>
<li><p>Molecular similarity measures</p>
<ul>
<li><p>Tanimoto coefficient</p></li>
<li><p>Dice coefficient</p></li>
</ul>
</li>
<li><p>Virtual screening</p>
<ul>
<li><p>Virtual screening using similarity search</p></li>
<li><p>Enrichment plots</p></li>
</ul>
</li>
</ul>
</section>
<section id="Contents-in-Practical">
<h3 id="Contents-in-Practical">Contents in <em>Practical</em><a class="headerlink" href="#Contents-in-Practical" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Import and draw molecules</p></li>
<li><p>Calculate molecular descriptors</p>
<ul>
<li><p>1D molecular descriptors: Molecular weight</p></li>
<li><p>2D molecular descriptors: MACCS fingerprint</p></li>
<li><p>2D molecular descriptors: Morgan fingerprint</p></li>
</ul>
</li>
<li><p>Calculate molecular similarity</p>
<ul>
<li><p>MACCS fingerprints: Tanimoto and Dice similarity</p></li>
<li><p>Morgan fingerprints: Tanimoto and Dice similarity</p></li>
</ul>
</li>
<li><p>Virtual screening using similarity search</p>
<ul>
<li><p>Compare query molecule to all molecules in the data set</p></li>
<li><p>Distribution of similarity values</p></li>
<li><p>Visualize most similar molecules</p></li>
<li><p>Generate enrichment plots</p></li>
<li><p>Calculate enrichment factors</p></li>
</ul>
</li>
</ul>
</section>
<section id="References">
<h3 id="References">References<a class="headerlink" href="#References" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Review on “Molecular similarity in medicinal chemistry” (<a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/24151987">J. Med. Chem. (2014), 57, 3186-3204</a>)</p></li>
<li><p><a class="reference external" href="http://www.rdkit.org/docs/GettingStartedInPython.html#morgan-fingerprints-circular-fingerprints">Morgan fingerprints</a> with <code class="docutils literal notranslate"><span class="pre">rdkit</span></code></p></li>
<li><p>Description of the extended-connectivity fingerprint ECFP (<a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ci100050t">J. Chem. Inf. Model. (2010), 50,742-754</a>)</p></li>
<li><p>What is the chemical space? (<a class="reference external" href="https://www.ncbi.nlm.nih.gov/pubmed/23019491">ACS Chem. Neurosci. (2012), 19, 649-57</a>)</p></li>
<li><p>List of <a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-descriptors">molecular descriptors</a> in <code class="docutils literal notranslate"><span class="pre">rdkit</span></code></p></li>
<li><p>List of <a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-fingerprints">fingerprints</a> in <code class="docutils literal notranslate"><span class="pre">rdkit</span></code></p></li>
<li><p>Introduction to enrichment plots (<a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/9783527806539.ch6h">Applied Chemoinformatics, Wiley-VCH Verlag GmbH &amp; Co. KGaA, Weinheim, (2018), 1, 313-31</a>)</p></li>
</ul>
</section>
</section>
<section id="Theory">
<h2 id="Theory">Theory<a class="headerlink" href="#Theory" title="Permalink to this heading">¶</a></h2>
<section id="Molecular-similarity">
<h3 id="Molecular-similarity">Molecular similarity<a class="headerlink" href="#Molecular-similarity" title="Permalink to this heading">¶</a></h3>
<p>Molecular similarity is a well known and often used concept in chemical informatics. Comparing molecules and their properties can be used in many different ways and help us to identify new molecules with desired properties and biological activity.</p>
<p>The similar property principle (SPP) as well as the structure-activity relationship (SAR) approaches are based on the assumption that structurally similar molecules have similar properties and, thus, similar biological activity. In this context, virtual screening follows this idea to search for similar molecules in given a set of molecules with known binding affinity and to propose those as potentially new active molecules.</p>
</section>
<section id="Molecular-descriptors">
<h3 id="Molecular-descriptors">Molecular descriptors<a class="headerlink" href="#Molecular-descriptors" title="Permalink to this heading">¶</a></h3>
<p>Similarity can be assessed in many different ways depending on the application (see <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/24151987">J. Med. Chem. (2014), 57, 3186-3204</a>):</p>
<ul class="simple">
<li><p>1D molecular descriptor: Solubility, logP, molecular weight, melting point.</p>
<ul>
<li><p>Global descriptor: only one value represents the whole molecule</p></li>
<li><p>Usually do not contain enough information to be applied to machine learning (ML)</p></li>
<li><p>Can be added to 2D fingerprints to improve molecular encoding for ML</p></li>
</ul>
</li>
<li><p>2D molecular descriptors: Molecular graphs, paths, fragments, atom environments</p>
<ul>
<li><p>Detailed representation of individual parts of the molecule</p></li>
<li><p>Contains many features/bits per molecule called fingerprints</p></li>
<li><p>Very often used in similarity search and ML</p></li>
</ul>
</li>
<li><p>3D molecular descriptors: Shape, stereochemistry</p>
<ul>
<li><p>Less robust than 2D representations because of molecule flexibility (what is the “right” conformation of a molecule?) Biological similarity</p></li>
<li><p>Biological fingerprint, e.g. individual bits represent bioactivity measure against different targets</p></li>
<li><p>Independent of molecular structure</p></li>
<li><p>Requires experimental (or predicted) data</p></li>
</ul>
</li>
</ul>
<p>We already learned how to calculate 1D physicochemical parameters, such as the molecular weight and logP in <strong>Talktorial T002</strong>. More information about these <a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-descriptors">descriptors</a> in the <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> documentation.</p>
<p>In the following, we focus on the definition of 2D molecular descriptors. Due to their, mostly, uniqueness per molecule, these descriptors are also called fingerprints.</p>
</section>
<section id="Molecular-fingerprints">
<h3 id="Molecular-fingerprints">Molecular fingerprints<a class="headerlink" href="#Molecular-fingerprints" title="Permalink to this heading">¶</a></h3>
<section id="Substructure-based-fingerprints">
<h4 id="Substructure-based-fingerprints">Substructure-based fingerprints<a class="headerlink" href="#Substructure-based-fingerprints" title="Permalink to this heading">¶</a></h4>
<p>Molecular fingerprints are a computational representation of molecules that encode chemical and molecular features in the form of bitstrings, bitvectors or arrays. Each bit corresponds to a predefined molecular feature or environment, where “1” represents the presence and “0” the absence of a feature. Note that some implementations are count-based. Thus, they count how often a specific feature is present.</p>
<p>There are multiple ways to design fingerprints. Here, we introduce MACCS keys and Morgan fingerprint as two commonly used 2D fingerprints. As can be seen in the <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> documentation on <a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-fingerprints">fingerprints</a>, <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> also offers multiple alternate fingerprints.</p>
</section>
<section id="MACCS-fingerprints">
<h4 id="MACCS-fingerprints">MACCS fingerprints<a class="headerlink" href="#MACCS-fingerprints" title="Permalink to this heading">¶</a></h4>
<p>Molecular ACCess System (MACCS) fingerprints, also termed MACCS structural keys, consist of 166 predefined structural fragments. Each position queries the presence or absence of one particular structural fragment or key. The individual keys were empirically defined by medicinal chemists and are simple to use and interpret (<code class="docutils literal notranslate"><span class="pre">rdkit</span></code> documentation on <a class="reference external" href="http://rdkit.org/Python_Docs/rdkit.Chem.MACCSkeys-module.html">MACCS keys</a>).</p>
<img alt="Figure 1" src="../_images/maccs_fp.png"/>
<p><em>Figure 1</em>: Illustration of MACCS fingerprint (figure by Andrea Morger).</p>
</section>
<section id="Morgan-fingerprints-and-circular-fingerprints">
<h4 id="Morgan-fingerprints-and-circular-fingerprints">Morgan fingerprints and circular fingerprints<a class="headerlink" href="#Morgan-fingerprints-and-circular-fingerprints" title="Permalink to this heading">¶</a></h4>
<p>This family of fingerprints is based on the Morgan algorithm. The bits correspond to the circular environments of each atom in a molecule. The number of neighboring bonds and atoms to consider is set by the radius. Also the length of the bit string can be defined, a longer bit string will be modded to the desired length. Therefore, the Morgan fingerprint is not limited to a certain number of bits. More about the <a class="reference external" href="http://www.rdkit.org/docs/GettingStartedInPython.html#morgan-fingerprints-circular-fingerprints">Morgan
fingerprint</a> can be found in the <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> documentation. Extended connectivity fingerprints (ECFP) are also commonly used fingerprints that are derived using a variant of the Morgan algorithm, see <a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/ci100050t">J. Chem. Inf. Model. (2010), 50,742-754</a> for further information.</p>
<img alt="Figure 2" src="../_images/morgan_fp.png"/>
<p><em>Figure 2</em>: Illustration of the Morgan circular fingerprint (figure by Andrea Morger).</p>
</section>
</section>
<section id="Molecular-similarity-measures">
<h3 id="Molecular-similarity-measures">Molecular similarity measures<a class="headerlink" href="#Molecular-similarity-measures" title="Permalink to this heading">¶</a></h3>
<p>Once the descriptors/fingerprints are calculated, they can be compared to assess the similarity between two molecules. Molecular similarity can be quantified with a number of different similarity coefficients, two common similarity measures are the Tanimoto and Dice index (<a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/24151987">J. Med. Chem. (2014), 57, 3186-3204</a>).</p>
<section id="Tanimoto-coefficient">
<h4 id="Tanimoto-coefficient">Tanimoto coefficient<a class="headerlink" href="#Tanimoto-coefficient" title="Permalink to this heading">¶</a></h4>
<div class="math notranslate nohighlight">
\[T _{c}(A,B) = \frac{c}{a+b-c}\]</div>
<ul class="simple">
<li><p>a: number of features present in molecule A</p></li>
<li><p>b: number of features present in molecule B</p></li>
<li><p>c: number of features shared by molecules A and B</p></li>
</ul>
</section>
<section id="Dice-coefficient">
<h4 id="Dice-coefficient">Dice coefficient<a class="headerlink" href="#Dice-coefficient" title="Permalink to this heading">¶</a></h4>
<div class="math notranslate nohighlight">
\[D_{c}(A,B) = \frac{c}{\frac{1}{2}(a+b)}\]</div>
<ul class="simple">
<li><p>a: number of features present in molecule A</p></li>
<li><p>b: number of features present in molecule B</p></li>
<li><p>c: number of features shared by molecules A and B</p></li>
</ul>
<p>The similarity measures usually consider the number of positive bits (1’s) present in either fingerprint and the number of positive bits that both have in common. Dice similarity usually returns higher values than Tanimoto similarity because of their denominators:</p>
<div class="math notranslate nohighlight">
\[\frac{c}{a+b-c} \leq \frac{c}{\frac{1}{2}(a+b)}\]</div>
</section>
</section>
<section id="Virtual-screening">
<h3 id="Virtual-screening">Virtual screening<a class="headerlink" href="#Virtual-screening" title="Permalink to this heading">¶</a></h3>
<p>The challenge in early stages of drug discovery is to narrow down a set of small molecules (molecules) from the large existing chemical space that are potentially binding to the target under investigation. Note that this chemical space is vast: Small molecules can be made of 1020 combinations of chemical moieties (<a class="reference external" href="https://www.ncbi.nlm.nih.gov/pubmed/23019491">ACS Chem. Neurosci. (2012), 19, 649-57</a>).</p>
<p>Since experimental high-throughput screening (HTS) for the activity of all those small molecules against the target of interest is cost and time intensive, computer-aided methods are invoked to propose a focused list of small molecules to be tested. This process is called virtual (high-throughput) screening: a large library of small molecules is filtered by rules and/or patterns, in order to identify those small molecules that are most likely to bind a target under investigation.</p>
<section id="Virtual-screening-using-similarity-search">
<h4 id="Virtual-screening-using-similarity-search">Virtual screening using similarity search<a class="headerlink" href="#Virtual-screening-using-similarity-search" title="Permalink to this heading">¶</a></h4>
<p>Comparing a set of novel molecules against a (or several) known active molecule(s) to find the most similar ones can be used as a simple way of virtual screening. Given the similar property principle, we can assume that the most similar molecules, e.g. to a known inhibitor, also have similar effects. Requirements for a similarity search are the following (as discussed in detail above):</p>
<ul class="simple">
<li><p>A representation that encodes chemical/molecular features</p></li>
<li><p>A potential weighting of features (optional)</p></li>
<li><p>A similarity measurement</p></li>
</ul>
<p>A similarity search can be performed by calculating the similarity between one molecule and all molecules in a specific dataset. Ranking the molecules of the dataset by their similarity coefficient yields the most similar molecules at the top.</p>
</section>
<section id="Enrichment-plots">
<h4 id="Enrichment-plots">Enrichment plots<a class="headerlink" href="#Enrichment-plots" title="Permalink to this heading">¶</a></h4>
<p>Enrichment plots are used to validate virtual screening results, which display the ratio of active molecules detected in the top x% of the ranked list, i.e.:</p>
<ul class="simple">
<li><p>the ratio of top-ranked molecules (x-axis) from the whole dataset vs.</p></li>
<li><p>the ratio of active molecules (y-axis) from the whole dataset.</p></li>
</ul>
<img alt="Figure 3" src="../_images/enrichment_plot.png"/>
<p><em>Figure 3</em>: Example of enrichment plot for virtual screening results.</p>
</section>
</section>
</section>
<section id="Practical">
<h2 id="Practical">Practical<a class="headerlink" href="#Practical" title="Permalink to this heading">¶</a></h2>
<p>In the first part of this practical section, we will use <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> to encode molecules (molecular fingerprints) and compare them in order to calculate their similarity (molecular similarity measures), as discussed in the theory section above.</p>
<p>In the second part, we will use these encoding and comparison techniques to conduct a similarity search (virtual screening): We use the known EGFR inhibitor Gefitinib as query and search for similar molecules in our data set of molecules tested on EGFR, which we collected from the ChEMBL database in <strong>Talktorial T001</strong> and filtered by Lipinski’s rule of five in <strong>Talktorial T002</strong>.</p>
<section id="Import-and-draw-molecules">
<h3 id="Import-and-draw-molecules">Import and draw molecules<a class="headerlink" href="#Import-and-draw-molecules" title="Permalink to this heading">¶</a></h3>
<p>First, we define and draw eight example molecules, which we will encode and compare later on. The molecules in SMILES format are converted to <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> molecule objects and visualized with the <code class="docutils literal notranslate"><span class="pre">Draw</span></code> module in <code class="docutils literal notranslate"><span class="pre">rdkit</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">DataStructs</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PandasTools</span><span class="p">,</span>
    <span class="n">Draw</span><span class="p">,</span>
    <span class="n">Descriptors</span><span class="p">,</span>
    <span class="n">MACCSkeys</span><span class="p">,</span>
    <span class="n">rdFingerprintGenerator</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HERE</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">_dh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="n">HERE</span> <span class="o">/</span> <span class="s2">"data"</span>
</pre></div>
</div>
</div>
<p>Let’s define some molecule examples.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Molecules in SMILES format</span>
<span class="n">molecule_smiles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"CC1C2C(C3C(C(=O)C(=C(C3(C(=O)C2=C(C4=C1C=CC=C4O)O)O)O)C(=O)N)N(C)C)O"</span><span class="p">,</span>
    <span class="s2">"CC1(C(N2C(S1)C(C2=O)NC(=O)C(C3=CC=C(C=C3)O)N)C(=O)O)C"</span><span class="p">,</span>
    <span class="s2">"C1=COC(=C1)CNC2=CC(=C(C=C2C(=O)O)S(=O)(=O)N)Cl"</span><span class="p">,</span>
    <span class="s2">"CCCCCCCCCCCC(=O)OCCOC(=O)CCCCCCCCCCC"</span><span class="p">,</span>
    <span class="s2">"C1NC2=CC(=C(C=C2S(=O)(=O)N1)S(=O)(=O)N)Cl"</span><span class="p">,</span>
    <span class="s2">"CC1=C(C(CCC1)(C)C)C=CC(=CC=CC(=CC(=O)O)C)C"</span><span class="p">,</span>
    <span class="s2">"CC1(C2CC3C(C(=O)C(=C(C3(C(=O)C2=C(C4=C1C=CC=C4O)O)O)O)C(=O)N)N(C)C)O"</span><span class="p">,</span>
    <span class="s2">"CC1C(CC(=O)C2=C1C=CC=C2O)C(=O)O"</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># List of molecule names</span>
<span class="n">molecule_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"Doxycycline"</span><span class="p">,</span>
    <span class="s2">"Amoxicilline"</span><span class="p">,</span>
    <span class="s2">"Furosemide"</span><span class="p">,</span>
    <span class="s2">"Glycol dilaurate"</span><span class="p">,</span>
    <span class="s2">"Hydrochlorothiazide"</span><span class="p">,</span>
    <span class="s2">"Isotretinoin"</span><span class="p">,</span>
    <span class="s2">"Tetracycline"</span><span class="p">,</span>
    <span class="s2">"Hemi-cycline D"</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>Generate a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> for these molecules and add their ROMol objects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"smiles"</span><span class="p">:</span> <span class="n">molecule_smiles</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="n">molecule_names</span><span class="p">})</span>
<span class="n">PandasTools</span><span class="o">.</span><span class="n">AddMoleculeColumnToFrame</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">smilesCol</span><span class="o">=</span><span class="s2">"smiles"</span><span class="p">)</span>
<span class="n">PandasTools</span><span class="o">.</span><span class="n">RenderImagesInAllDataFrames</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Show first 2 molecules</span>
<span class="n">molecules</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>smiles</th>
<th>name</th>
<th>ROMol</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>CC1C2C(C3C(C(=O)C(=C(C3(C(=O)C2=C(C4=C1C=CC=C4...</td>
<td>Doxycycline</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90babcb1c0&gt;</td>
</tr>
<tr>
<th>1</th>
<td>CC1(C(N2C(S1)C(C2=O)NC(=O)C(C3=CC=C(C=C3)O)N)C...</td>
<td>Amoxicilline</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90babcb220&gt;</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>Visualize all molecules.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="n">legends</span><span class="o">=</span><span class="n">molecules</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_28_0.png" src="../_images/talktorials_T004_compound_similarity_28_0.png"/>
</div>
</div>
</section>
<section id="Calculate-molecular-descriptors">
<h3 id="Calculate-molecular-descriptors">Calculate molecular descriptors<a class="headerlink" href="#Calculate-molecular-descriptors" title="Permalink to this heading">¶</a></h3>
<p>We extract and generate 1D and 2D molecular descriptors to compare our molecules. For 2D descriptors, different types of fingerprints are generated to be used later for the calculation of the molecular similarity.</p>
<section id="1D-molecular-descriptors:-Molecular-weight">
<h4 id="1D-molecular-descriptors:-Molecular-weight">1D molecular descriptors: Molecular weight<a class="headerlink" href="#1D-molecular-descriptors:-Molecular-weight" title="Permalink to this heading">¶</a></h4>
<p>We calculate the molecular weight of our example structures.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note -- we use pandas apply function to apply the MolWt function</span>
<span class="c1"># to all ROMol objects in the DataFrame</span>
<span class="n">molecules</span><span class="p">[</span><span class="s2">"molecule_weight"</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecules</span><span class="o">.</span><span class="n">ROMol</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Descriptors</span><span class="o">.</span><span class="n">MolWt</span><span class="p">)</span>
<span class="c1"># Sort molecules by molecular weight</span>
<span class="n">molecules</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">"molecule_weight"</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We draw our molecular structures with their similar molecular weight for visual comparison: Is the molecular weight a feasible descriptor for molecule similarity?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show only molecule names and molecular weights</span>
<span class="n">molecules</span><span class="p">[[</span><span class="s2">"smiles"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"molecule_weight"</span><span class="p">]]</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>smiles</th>
<th>name</th>
<th>molecule_weight</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>CC1C2C(C3C(C(=O)C(=C(C3(C(=O)C2=C(C4=C1C=CC=C4...</td>
<td>Doxycycline</td>
<td>444.440</td>
</tr>
<tr>
<th>6</th>
<td>CC1(C2CC3C(C(=O)C(=C(C3(C(=O)C2=C(C4=C1C=CC=C4...</td>
<td>Tetracycline</td>
<td>444.440</td>
</tr>
<tr>
<th>3</th>
<td>CCCCCCCCCCCC(=O)OCCOC(=O)CCCCCCCCCCC</td>
<td>Glycol dilaurate</td>
<td>426.682</td>
</tr>
<tr>
<th>1</th>
<td>CC1(C(N2C(S1)C(C2=O)NC(=O)C(C3=CC=C(C=C3)O)N)C...</td>
<td>Amoxicilline</td>
<td>365.411</td>
</tr>
<tr>
<th>2</th>
<td>C1=COC(=C1)CNC2=CC(=C(C=C2C(=O)O)S(=O)(=O)N)Cl</td>
<td>Furosemide</td>
<td>330.749</td>
</tr>
<tr>
<th>5</th>
<td>CC1=C(C(CCC1)(C)C)C=CC(=CC=CC(=CC(=O)O)C)C</td>
<td>Isotretinoin</td>
<td>300.442</td>
</tr>
<tr>
<th>4</th>
<td>C1NC2=CC(=C(C=C2S(=O)(=O)N1)S(=O)(=O)N)Cl</td>
<td>Hydrochlorothiazide</td>
<td>297.745</td>
</tr>
<tr>
<th>7</th>
<td>CC1C(CC(=O)C2=C1C=CC=C2O)C(=O)O</td>
<td>Hemi-cycline D</td>
<td>220.224</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>We draw the molecules with their molecular weight.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">],</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span>
        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">molecule</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">molecule</span><span class="p">[</span><span class="s1">'molecule_weight'</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Da"</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_35_0.png" src="../_images/talktorials_T004_compound_similarity_35_0.png"/>
</div>
</div>
<p>As we can see, molecules with similar molecular weight can have a similar structure (e.g. Doxycycline/Tetracycline), however they can also have a similar number of atoms in completely different arrangements (e.g. Doxycycline/Glycol dilaurate or Hydrochlorothiazide/Isotretinoin).</p>
<p>In order to account for more detailed properties of a molecule, we now take a look at 2D molecular descriptors.</p>
</section>
<section id="2D-molecular-descriptors:-MACCS-fingerprint">
<h4 id="2D-molecular-descriptors:-MACCS-fingerprint">2D molecular descriptors: MACCS fingerprint<a class="headerlink" href="#2D-molecular-descriptors:-MACCS-fingerprint" title="Permalink to this heading">¶</a></h4>
<p><strong>Example molecule</strong>: Let’s use an example molecule from our <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">molecule</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_39_0.png" src="../_images/talktorials_T004_compound_similarity_39_0.png"/>
</div>
</div>
<p>MACCS fingerprints can be easily generated using <code class="docutils literal notranslate"><span class="pre">rdkit</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maccs_fp</span> <span class="o">=</span> <span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As explicit bitvectors are not human-readable, we will further transform them to bitstrings.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">maccs_fp</span><span class="o">.</span><span class="n">ToBitString</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
'00000000000000000000000000100000000000000000000000100110000000000010000010101000000011100100110101010100010000101100010000100001000101001001111111101111101011111111110'
</pre></div></div>
</div>
<p><strong>Applied to all molecules</strong>: Add MACCS fingerprints for all molecules to the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecules</span><span class="p">[</span><span class="s2">"maccs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecules</span><span class="o">.</span><span class="n">ROMol</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2D-molecular-descriptors:-Morgan-fingerprint">
<h4 id="2D-molecular-descriptors:-Morgan-fingerprint">2D molecular descriptors: Morgan fingerprint<a class="headerlink" href="#2D-molecular-descriptors:-Morgan-fingerprint" title="Permalink to this heading">¶</a></h4>
<p>We can also calculate the circular Morgan fingerprints with <code class="docutils literal notranslate"><span class="pre">rdkit</span></code>. The Morgan fingerprint can be calculated either as int or bit vector. We specify a radius of 2 and a vector of length 2048.</p>
<p><strong>Example molecule</strong>: Let’s use again with our example molecule.</p>
<p>Generate the Morgan fingerprint <em>as int vector</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpg</span> <span class="o">=</span> <span class="n">rdFingerprintGenerator</span><span class="o">.</span><span class="n">GetMorganGenerator</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fpSize</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span>
<span class="n">circular_int_fp</span> <span class="o">=</span> <span class="n">fpg</span><span class="o">.</span><span class="n">GetCountFingerprint</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
<span class="n">circular_int_fp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;rdkit.DataStructs.cDataStructs.UIntSparseIntVect at 0x7f90b927b200&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Print non-zero elements:</span><span class="se">\n</span><span class="si">{</span><span class="n">circular_int_fp</span><span class="o">.</span><span class="n">GetNonzeroElements</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Print non-zero elements:
{45: 1, 118: 1, 140: 1, 163: 1, 276: 1, 303: 1, 309: 1, 314: 2, 371: 1, 438: 1, 525: 1, 557: 1, 650: 3, 673: 1, 699: 1, 807: 6, 824: 1, 829: 1, 881: 1, 1009: 1, 1019: 5, 1027: 1, 1039: 1, 1057: 3, 1060: 1, 1061: 1, 1070: 1, 1082: 1, 1088: 1, 1119: 1, 1154: 1, 1163: 2, 1171: 1, 1257: 1, 1296: 1, 1309: 1, 1341: 1, 1380: 9, 1389: 1, 1457: 1, 1471: 1, 1487: 1, 1582: 1, 1602: 3, 1607: 1, 1630: 1, 1747: 1, 1750: 2, 1831: 1, 1833: 1, 1857: 1, 1873: 3, 1917: 1, 1932: 1, 2000: 1, 2029: 1}
</pre></div></div>
</div>
<p>Generate the Morgan fingerprint <em>as bit vector</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that the function takes a list as input parameter</span>
<span class="c1"># (even if we only want to pass one molecule)</span>
<span class="n">circular_bit_fp</span> <span class="o">=</span> <span class="n">fpg</span><span class="o">.</span><span class="n">GetFingerprint</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
<span class="n">circular_bit_fp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;rdkit.DataStructs.cDataStructs.ExplicitBitVect at 0x7f90b927b3c0&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Print top 400 fingerprint bits:</span><span class="se">\n</span><span class="si">{</span><span class="n">circular_bit_fp</span><span class="o">.</span><span class="n">ToBitString</span><span class="p">()[:</span><span class="mi">400</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Print top 400 fingerprint bits:
0000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000010000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001000001000010000000000000000000000000000000000000000000000000000000010000000000000000000000000000
</pre></div></div>
</div>
<p><strong>Applied to all molecules</strong>: Add Morgan fingerprints (as bit vector) for all molecules to the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecules</span><span class="p">[</span><span class="s2">"morgan"</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fpg</span><span class="o">.</span><span class="n">GetFingerprint</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Calculate-molecular-similarity">
<h3 id="Calculate-molecular-similarity">Calculate molecular similarity<a class="headerlink" href="#Calculate-molecular-similarity" title="Permalink to this heading">¶</a></h3>
<p>In the following, we will apply two similarity measures, i.e. <strong>Tanimoto</strong> and <strong>Dice</strong>, to our two fingerprint types, i.e. <strong>MACCS</strong> and <strong>Morgan</strong> fingerprints.</p>
<p><strong>Example molecule pair</strong>: Compare two MACCS fingerprints with the Tanimoto similarity.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example molecules</span>
<span class="n">molecule1</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">molecule2</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Example fingerprints</span>
<span class="n">maccs_fp1</span> <span class="o">=</span> <span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">(</span><span class="n">molecule1</span><span class="p">)</span>
<span class="n">maccs_fp2</span> <span class="o">=</span> <span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">(</span><span class="n">molecule2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Calculate the Tanimoto coefficient <em>between two different molecules</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">DataStructs</span><span class="o">.</span><span class="n">TanimotoSimilarity</span><span class="p">(</span><span class="n">maccs_fp1</span><span class="p">,</span> <span class="n">maccs_fp2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.5909090909090909
</pre></div></div>
</div>
<p>Calculate Tanimoto coefficient <em>between the same molecule</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">DataStructs</span><span class="o">.</span><span class="n">TanimotoSimilarity</span><span class="p">(</span><span class="n">maccs_fp1</span><span class="p">,</span> <span class="n">maccs_fp1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.0
</pre></div></div>
</div>
<p>In the following, we want to compare a query molecule with our molecule list. Therefore, we use <code class="docutils literal notranslate"><span class="pre">BulkTanimotoSimilarity</span></code> and <code class="docutils literal notranslate"><span class="pre">BulkDiceSimilarity</span></code> from <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> that calculate the similarity of a query fingerprint with a list of fingerprints, based on a similarity measure. We will investigate all combinations of MACCS/Morgan fingerprint comparisons based on the Tanimoto/Dice similarity measure.</p>
<section id="MACCS-fingerprints:-Tanimoto-similarity-and-Dice-similarity">
<h4 id="MACCS-fingerprints:-Tanimoto-similarity-and-Dice-similarity">MACCS fingerprints: Tanimoto similarity and Dice similarity<a class="headerlink" href="#MACCS-fingerprints:-Tanimoto-similarity-and-Dice-similarity" title="Permalink to this heading">¶</a></h4>
<p>Add the Tanimoto and Dice similarities between MACCS fingerprints to the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define molecule query and list</span>
<span class="n">molecule_query</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"maccs"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">molecule_list</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"maccs"</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="c1"># Calculate similarty values between query and list elements</span>
<span class="n">molecules</span><span class="p">[</span><span class="s2">"tanimoto_maccs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">molecule_query</span><span class="p">,</span> <span class="n">molecule_list</span><span class="p">)</span>
<span class="n">molecules</span><span class="p">[</span><span class="s2">"dice_maccs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkDiceSimilarity</span><span class="p">(</span><span class="n">molecule_query</span><span class="p">,</span> <span class="n">molecule_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Sort the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by the Tanimoto similarity of the MACCS fingerprints (show only name and similarity columns!).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preview</span> <span class="o">=</span> <span class="n">molecules</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">"tanimoto_maccs"</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">preview</span><span class="p">[[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"tanimoto_maccs"</span><span class="p">,</span> <span class="s2">"dice_maccs"</span><span class="p">]]</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>name</th>
<th>tanimoto_maccs</th>
<th>dice_maccs</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Doxycycline</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
<tr>
<th>1</th>
<td>Tetracycline</td>
<td>0.928571</td>
<td>0.962963</td>
</tr>
<tr>
<th>2</th>
<td>Amoxicilline</td>
<td>0.590909</td>
<td>0.742857</td>
</tr>
<tr>
<th>3</th>
<td>Hemi-cycline D</td>
<td>0.403509</td>
<td>0.575000</td>
</tr>
<tr>
<th>4</th>
<td>Furosemide</td>
<td>0.321839</td>
<td>0.486957</td>
</tr>
<tr>
<th>5</th>
<td>Hydrochlorothiazide</td>
<td>0.306818</td>
<td>0.469565</td>
</tr>
<tr>
<th>6</th>
<td>Isotretinoin</td>
<td>0.288136</td>
<td>0.447368</td>
</tr>
<tr>
<th>7</th>
<td>Glycol dilaurate</td>
<td>0.149254</td>
<td>0.259740</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p><strong>Note</strong>: Tanimoto and Dice similarity measures by definition result in the same ranking of molecules, with higher values for the Dice similarity (see Tanimoto and Dice equations in the theory section of this talktorial).</p>
<p>Draw molecules ranked by the Tanimoto similarity of MACCS fingerprints.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_ranked_molecules</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">sort_by_column</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Draw molecules sorted by a given column.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    molecules : pandas.DataFrame</span>
<span class="sd">        Molecules (with "ROMol" and "name" columns and a column to sort by.</span>
<span class="sd">    sort_by_column : str</span>
<span class="sd">        Name of the column used to sort the molecules by.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Draw.MolsToGridImage</span>
<span class="sd">        2D visualization of sorted molecules.</span>
<span class="sd">    """</span>

    <span class="n">molecules_sorted</span> <span class="o">=</span> <span class="n">molecules</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">sort_by_column</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
        <span class="n">molecules_sorted</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">],</span>
        <span class="n">legends</span><span class="o">=</span><span class="p">[</span>
            <span class="sa">f</span><span class="s2">"#</span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">molecule</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2">, similarity=</span><span class="si">{</span><span class="n">molecule</span><span class="p">[</span><span class="n">sort_by_column</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules_sorted</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
        <span class="p">],</span>
        <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_ranked_molecules</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="s2">"tanimoto_maccs"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_70_0.png" src="../_images/talktorials_T004_compound_similarity_70_0.png"/>
</div>
</div>
<p>With MACCS fingerprints, Tetracycline is the most similar molecule (high score), followed by Amoxicilline. In contrast to the 1D descriptor molecular weight, the linear molecule Glycol dilaurate is recognized as dissimilar (last rank).</p>
</section>
<section id="Morgan-fingerprints:-Tanimoto-similarity-and-Dice-similarity">
<h4 id="Morgan-fingerprints:-Tanimoto-similarity-and-Dice-similarity">Morgan fingerprints: Tanimoto similarity and Dice similarity<a class="headerlink" href="#Morgan-fingerprints:-Tanimoto-similarity-and-Dice-similarity" title="Permalink to this heading">¶</a></h4>
<p>Add the Tanimoto and Dice similarities between the Morgan fingerprints to the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define molecule query and list</span>
<span class="n">molecule_query</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"morgan"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">molecule_list</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"morgan"</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="c1"># Calculate similarty values between query and list elements</span>
<span class="n">molecules</span><span class="p">[</span><span class="s2">"tanimoto_morgan"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">molecule_query</span><span class="p">,</span> <span class="n">molecule_list</span><span class="p">)</span>
<span class="n">molecules</span><span class="p">[</span><span class="s2">"dice_morgan"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkDiceSimilarity</span><span class="p">(</span><span class="n">molecule_query</span><span class="p">,</span> <span class="n">molecule_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Sort the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by the Tanimoto similarity of the Morgan fingerprints.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preview</span> <span class="o">=</span> <span class="n">molecules</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">"tanimoto_morgan"</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">preview</span><span class="p">[[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"tanimoto_morgan"</span><span class="p">,</span> <span class="s2">"dice_morgan"</span><span class="p">,</span> <span class="s2">"tanimoto_maccs"</span><span class="p">,</span> <span class="s2">"dice_maccs"</span><span class="p">]]</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>name</th>
<th>tanimoto_morgan</th>
<th>dice_morgan</th>
<th>tanimoto_maccs</th>
<th>dice_maccs</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Doxycycline</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
<tr>
<th>1</th>
<td>Tetracycline</td>
<td>0.534247</td>
<td>0.696429</td>
<td>0.928571</td>
<td>0.962963</td>
</tr>
<tr>
<th>2</th>
<td>Hemi-cycline D</td>
<td>0.308824</td>
<td>0.471910</td>
<td>0.403509</td>
<td>0.575000</td>
</tr>
<tr>
<th>3</th>
<td>Amoxicilline</td>
<td>0.144444</td>
<td>0.252427</td>
<td>0.590909</td>
<td>0.742857</td>
</tr>
<tr>
<th>4</th>
<td>Furosemide</td>
<td>0.098901</td>
<td>0.180000</td>
<td>0.321839</td>
<td>0.486957</td>
</tr>
<tr>
<th>5</th>
<td>Isotretinoin</td>
<td>0.067416</td>
<td>0.126316</td>
<td>0.288136</td>
<td>0.447368</td>
</tr>
<tr>
<th>6</th>
<td>Hydrochlorothiazide</td>
<td>0.058824</td>
<td>0.111111</td>
<td>0.306818</td>
<td>0.469565</td>
</tr>
<tr>
<th>7</th>
<td>Glycol dilaurate</td>
<td>0.054795</td>
<td>0.103896</td>
<td>0.149254</td>
<td>0.259740</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>Draw molecules ranked by the Tanimoto similarities of Morgan fingerprints.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_ranked_molecules</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="s2">"tanimoto_morgan"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_78_0.png" src="../_images/talktorials_T004_compound_similarity_78_0.png"/>
</div>
</div>
<p>We compare the Tanimoto similarities based on MACCS and Morgan fingerprints. Therefore, we plot the Tanimoto similarities based on Morgen fingerprints vs. the Tanimoto simlarities based on MACCS fingerprints.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">molecules</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">"tanimoto_maccs"</span><span class="p">,</span> <span class="s2">"tanimoto_morgan"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"scatter"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"k--"</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Tanimoto (MACCS)"</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Tanimoto (Morgan)"</span><span class="p">)</span>
<span class="n">fig</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_80_0.png" src="../_images/talktorials_T004_compound_similarity_80_0.png"/>
</div>
</div>
<p>Usage of different fingerprints (here: MACCS and Morgan fingerprints) results in different similarity values (here: Tanimoto similarity) and thus potentially also in different rankings of molecule similarity as shown here.</p>
<p>Morgan fingerprints also recognize Tetracycline as the most similar molecule to Doxycycline (but with a lower score), and Clycol dilaurate as most dissimilar. However, ranked second is Hemi-cycline D, a structural part of cyclines - possibly because of the atom environment-based algorithm of Morgan fingerprints (whereas MACCS fingerprints rather ask for the occurrence of certain properties).</p>
</section>
</section>
<section id="id1">
<h3 id="id1">Virtual screening using similarity search<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>Now that we have learned how to calculate fingerprints and the similarity between them, we can apply this knowledge to a similarity search of a query molecule against a full data set of molecules.</p>
<p>We use the known EGFR inhibitor Gefitinib as query and search for similar molecules in our data set of molecules tested on EGFR, which we collected from the ChEMBL database in <strong>Talktorial T001</strong> and filtered by Lipinski’s rule of five in <strong>Talktorial T002</strong>.</p>
<section id="Compare-query-molecule-to-all-molecules-in-the-data-set">
<h4 id="Compare-query-molecule-to-all-molecules-in-the-data-set">Compare query molecule to all molecules in the data set<a class="headerlink" href="#Compare-query-molecule-to-all-molecules-in-the-data-set" title="Permalink to this heading">¶</a></h4>
<p>We import molecules from a <em>csv</em> file containing the filtered EGFR-tested molecules from the ChEMBL database as provided by <strong>Talktorial T002</strong>. Given one query molecule (here Gefitinib), we screen that data set for similar molecules.</p>
<p><strong>Dataset</strong>: Import data from the <em>csv</em> file containing molecules in the SMILES format.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">HERE</span> <span class="o">/</span> <span class="s2">"../T002_compound_adme/data/EGFR_compounds_lipinski.csv"</span><span class="p">,</span>
    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">"molecule_chembl_id"</span><span class="p">,</span> <span class="s2">"smiles"</span><span class="p">,</span> <span class="s2">"pIC50"</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of molecules in dataset: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecule_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of molecules in dataset: 4635
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>molecule_chembl_id</th>
<th>smiles</th>
<th>pIC50</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>CHEMBL63786</td>
<td>Brc1cccc(Nc2ncnc3cc4ccccc4cc23)c1</td>
<td>11.522879</td>
</tr>
<tr>
<th>1</th>
<td>CHEMBL35820</td>
<td>CCOc1cc2ncnc(Nc3cccc(Br)c3)c2cc1OCC</td>
<td>11.221849</td>
</tr>
<tr>
<th>2</th>
<td>CHEMBL53711</td>
<td>CN(C)c1cc2c(Nc3cccc(Br)c3)ncnc2cn1</td>
<td>11.221849</td>
</tr>
<tr>
<th>3</th>
<td>CHEMBL66031</td>
<td>Brc1cccc(Nc2ncnc3cc4[nH]cnc4cc23)c1</td>
<td>11.096910</td>
</tr>
<tr>
<th>4</th>
<td>CHEMBL53753</td>
<td>CNc1cc2c(Nc3cccc(Br)c3)ncnc2cn1</td>
<td>11.096910</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p><strong>Query</strong>: For the query molecule Gefitinib, generate the <code class="docutils literal notranslate"><span class="pre">ROMol</span></code> object from the query molecule’s SMILES.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">"COC1=C(OCCCN2CCOCC2)C=C2C(NC3=CC(Cl)=C(F)C=C3)=NC=NC2=C1"</span><span class="p">)</span>
<span class="n">query</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_87_0.png" src="../_images/talktorials_T004_compound_similarity_87_0.png"/>
</div>
</div>
<p>Generate MACCS and Morgan fingerprints for the query molecule.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maccs_fp_query</span> <span class="o">=</span> <span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">circular_fp_query</span> <span class="o">=</span> <span class="n">fpg</span><span class="o">.</span><span class="n">GetCountFingerprint</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Generate MACCS and Morgan fingerprints for all molecules in our dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PandasTools</span><span class="o">.</span><span class="n">AddMoleculeColumnToFrame</span><span class="p">(</span><span class="n">molecule_dataset</span><span class="p">,</span> <span class="s2">"smiles"</span><span class="p">)</span>
<span class="n">circular_fp_list</span> <span class="o">=</span> <span class="n">molecule_dataset</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fpg</span><span class="o">.</span><span class="n">GetCountFingerprint</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">maccs_fp_list</span> <span class="o">=</span> <span class="n">molecule_dataset</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Calculate the Tanimoto similarity between the query molecule (Gefitinib) and all molecules our dataset (using MACCS and Morgan fingerprints).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule_dataset</span><span class="p">[</span><span class="s2">"tanimoto_maccs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span>
    <span class="n">maccs_fp_query</span><span class="p">,</span> <span class="n">maccs_fp_list</span>
<span class="p">)</span>
<span class="n">molecule_dataset</span><span class="p">[</span><span class="s2">"tanimoto_morgan"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span>
    <span class="n">circular_fp_query</span><span class="p">,</span> <span class="n">circular_fp_list</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Calculate Dice similarity for query molecule (Gefitinib) and all molecules in file (MACCS, Morgan).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule_dataset</span><span class="p">[</span><span class="s2">"dice_maccs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkDiceSimilarity</span><span class="p">(</span><span class="n">maccs_fp_query</span><span class="p">,</span> <span class="n">maccs_fp_list</span><span class="p">)</span>
<span class="n">molecule_dataset</span><span class="p">[</span><span class="s2">"dice_morgan"</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkDiceSimilarity</span><span class="p">(</span>
    <span class="n">circular_fp_query</span><span class="p">,</span> <span class="n">circular_fp_list</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">molecule_dataset</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">"smiles"</span><span class="p">,</span> <span class="s2">"tanimoto_maccs"</span><span class="p">,</span> <span class="s2">"tanimoto_morgan"</span><span class="p">,</span> <span class="s2">"dice_maccs"</span><span class="p">,</span> <span class="s2">"dice_morgan"</span><span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>smiles</th>
<th>tanimoto_maccs</th>
<th>tanimoto_morgan</th>
<th>dice_maccs</th>
<th>dice_morgan</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Brc1cccc(Nc2ncnc3cc4ccccc4cc23)c1</td>
<td>0.409836</td>
<td>0.324786</td>
<td>0.581395</td>
<td>0.490323</td>
</tr>
<tr>
<th>1</th>
<td>CCOc1cc2ncnc(Nc3cccc(Br)c3)c2cc1OCC</td>
<td>0.666667</td>
<td>0.445455</td>
<td>0.800000</td>
<td>0.616352</td>
</tr>
<tr>
<th>2</th>
<td>CN(C)c1cc2c(Nc3cccc(Br)c3)ncnc2cn1</td>
<td>0.484375</td>
<td>0.327434</td>
<td>0.652632</td>
<td>0.493333</td>
</tr>
<tr>
<th>3</th>
<td>Brc1cccc(Nc2ncnc3cc4[nH]cnc4cc23)c1</td>
<td>0.384615</td>
<td>0.345133</td>
<td>0.555556</td>
<td>0.513158</td>
</tr>
<tr>
<th>4</th>
<td>CNc1cc2c(Nc3cccc(Br)c3)ncnc2cn1</td>
<td>0.428571</td>
<td>0.333333</td>
<td>0.600000</td>
<td>0.500000</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show all columns</span>
<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>molecule_chembl_id</th>
<th>smiles</th>
<th>pIC50</th>
<th>ROMol</th>
<th>tanimoto_maccs</th>
<th>tanimoto_morgan</th>
<th>dice_maccs</th>
<th>dice_morgan</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>CHEMBL63786</td>
<td>Brc1cccc(Nc2ncnc3cc4ccccc4cc23)c1</td>
<td>11.522879</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b904c280&gt;</td>
<td>0.409836</td>
<td>0.324786</td>
<td>0.581395</td>
<td>0.490323</td>
</tr>
<tr>
<th>1</th>
<td>CHEMBL35820</td>
<td>CCOc1cc2ncnc(Nc3cccc(Br)c3)c2cc1OCC</td>
<td>11.221849</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b904c100&gt;</td>
<td>0.666667</td>
<td>0.445455</td>
<td>0.800000</td>
<td>0.616352</td>
</tr>
<tr>
<th>2</th>
<td>CHEMBL53711</td>
<td>CN(C)c1cc2c(Nc3cccc(Br)c3)ncnc2cn1</td>
<td>11.221849</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b904cca0&gt;</td>
<td>0.484375</td>
<td>0.327434</td>
<td>0.652632</td>
<td>0.493333</td>
</tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="Distribution-of-similarity-values">
<h4 id="Distribution-of-similarity-values">Distribution of similarity values<a class="headerlink" href="#Distribution-of-similarity-values" title="Permalink to this heading">¶</a></h4>
<p>As mentioned in the theory section, compared for the same fingerprint (e.g. MACCS fingerprints), Tanimoto similarity values are lower than Dice similarity values. Also, comparing two different fingerprints (e.g. MACCS and Morgan fingerprints), the similarity measure values (e.g. Tanimotot similarity) vary.</p>
<p>We can have a look at the distributions by plotting histograms.</p>
<p>First, we can plot distribution of Tanimoto similarity of MACCS fingerprints.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="s2">"tanimoto_maccs"</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="s2">"tanimoto_morgan"</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="s2">"dice_maccs"</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="s2">"dice_morgan"</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"similarity value"</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"# molecules"</span><span class="p">)</span>
<span class="n">fig</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_100_0.png" src="../_images/talktorials_T004_compound_similarity_100_0.png"/>
</div>
</div>
<p>Second, we can compare similarities here. This time, let’s directly compare Tanimoto and Dice similarities for the two fingerprints.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">"tanimoto_maccs"</span><span class="p">,</span> <span class="s2">"dice_maccs"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"scatter"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"k--"</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Tanimoto (MACCS)"</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Dice (MACCS)"</span><span class="p">)</span>

<span class="n">molecule_dataset</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">"tanimoto_morgan"</span><span class="p">,</span> <span class="s2">"dice_morgan"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"scatter"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"k--"</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Tanimoto (Morgan)"</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Dice (Morgan)"</span><span class="p">)</span>

<span class="n">fig</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_102_0.png" src="../_images/talktorials_T004_compound_similarity_102_0.png"/>
</div>
</div>
<p>Similarity distributions are important to interpret similarity values, e.g. a value of 0.6 needs to be evaluated differently for MACCS or Morgan fingerprints, as well as Tanimoto or Dice similarities.</p>
</section>
<section id="Visualize-most-similar-molecules">
<h4 id="Visualize-most-similar-molecules">Visualize most similar molecules<a class="headerlink" href="#Visualize-most-similar-molecules" title="Permalink to this heading">¶</a></h4>
<p>We visually inspect the structure of Gefitinib in comparison to the most similar molecules in our ranking, including the information about their bioactivity (pIC50 derived from the ChEMBL database in <strong>Talktorial T001</strong>).</p>
<p>Here, we sort the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by the Tanimoto similarity based on Morgan fingerprints.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule_dataset</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">"tanimoto_morgan"</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>molecule_chembl_id</th>
<th>smiles</th>
<th>pIC50</th>
<th>ROMol</th>
<th>tanimoto_maccs</th>
<th>tanimoto_morgan</th>
<th>dice_maccs</th>
<th>dice_morgan</th>
</tr>
</thead>
<tbody>
<tr>
<th>2639</th>
<td>CHEMBL939</td>
<td>COc1cc2ncnc(Nc3ccc(F)c(Cl)c3)c2cc1OCCCN1CCOCC1</td>
<td>6.288193</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b9018ac0&gt;</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
<tr>
<th>880</th>
<td>CHEMBL14699</td>
<td>COc1cc2ncnc(Nc3ccc(F)c(Cl)c3)c2cc1OCCN1CCOCC1</td>
<td>8.000000</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b906eca0&gt;</td>
<td>1.000000</td>
<td>0.923913</td>
<td>1.000000</td>
<td>0.960452</td>
</tr>
<tr>
<th>1747</th>
<td>CHEMBL299672</td>
<td>COc1cc2ncnc(Nc3ccc(F)c(Cl)c3)c2cc1OCCCN1CCCC1</td>
<td>7.148742</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b9003700&gt;</td>
<td>0.919355</td>
<td>0.843750</td>
<td>0.957983</td>
<td>0.915254</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>Show the query and its most similar molecules alongside the molecules’ bioactivities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_n_molecules</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">top_molecules</span> <span class="o">=</span> <span class="n">molecule_dataset</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">"tanimoto_morgan"</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">top_molecules</span> <span class="o">=</span> <span class="n">top_molecules</span><span class="p">[:</span><span class="n">top_n_molecules</span><span class="p">]</span>
<span class="n">legends</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sa">f</span><span class="s2">"#</span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">molecule</span><span class="p">[</span><span class="s1">'molecule_chembl_id'</span><span class="p">]</span><span class="si">}</span><span class="s2">, pIC50=</span><span class="si">{</span><span class="n">molecule</span><span class="p">[</span><span class="s1">'pIC50'</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">top_molecules</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">Chem</span><span class="o">.</span><span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="n">mols</span><span class="o">=</span><span class="p">[</span><span class="n">query</span><span class="p">]</span> <span class="o">+</span> <span class="n">top_molecules</span><span class="p">[</span><span class="s2">"ROMol"</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">([</span><span class="s2">"Gefitinib"</span><span class="p">]</span> <span class="o">+</span> <span class="n">legends</span><span class="p">),</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_109_0.png" src="../_images/talktorials_T004_compound_similarity_109_0.png"/>
</div>
</div>
<p>The top ranked molecules for Gefitinib are Gefitinib entries (rank 1 and 2) in our dataset, followed by alterations of Gefitinib, e.g. different benzole substitution patterns. Note: ChEMBL contains the complete structure-activity relationship analysis for Gefitinib (being a well-studied molecule), therefore it is not surprising to have that many Gefitinib-like molecules in our dataset.</p>
<p>We now check how well the similarity search is able to distinguish between active and inactive molecules based on our dataset. Therefore, we use the bioactivity values, which we collected from ChEMBL for each molecule (bioactivity against EGFR) in <strong>Talktorial T001</strong>.</p>
</section>
<section id="Generate-enrichment-plots">
<h4 id="Generate-enrichment-plots">Generate enrichment plots<a class="headerlink" href="#Generate-enrichment-plots" title="Permalink to this heading">¶</a></h4>
<p>In order to validate our virtual screening and see the ratio of detected active molecules, we generate an enrichment plot.</p>
<p><strong>Enrichment plots</strong> show</p>
<ul class="simple">
<li><p>the ratio of top-ranked molecules (x-axis) from the whole dataset vs.</p></li>
<li><p>the ratio of active molecules (y-axis) from the whole dataset.</p></li>
</ul>
<p>We compare the Tanimoto similarity for MACCS and Morgan fingerprints.</p>
<p>In order to decide whether we treat a molecule as active or inactive, we apply the commonly used pIC50 cutoff value of 6.3. Although there are several suggestions ranging from an pIC50 cutoff values of 5 to 7 in the literature or even to define an exclusion range, we think this cutoff is reasonable. The same cutoff will be used for machine learning in <strong>Talktorial T010</strong>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>molecule_chembl_id</th>
<th>smiles</th>
<th>pIC50</th>
<th>ROMol</th>
<th>tanimoto_maccs</th>
<th>tanimoto_morgan</th>
<th>dice_maccs</th>
<th>dice_morgan</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>CHEMBL63786</td>
<td>Brc1cccc(Nc2ncnc3cc4ccccc4cc23)c1</td>
<td>11.522879</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b904c280&gt;</td>
<td>0.409836</td>
<td>0.324786</td>
<td>0.581395</td>
<td>0.490323</td>
</tr>
<tr>
<th>1</th>
<td>CHEMBL35820</td>
<td>CCOc1cc2ncnc(Nc3cccc(Br)c3)c2cc1OCC</td>
<td>11.221849</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b904c100&gt;</td>
<td>0.666667</td>
<td>0.445455</td>
<td>0.800000</td>
<td>0.616352</td>
</tr>
<tr>
<th>2</th>
<td>CHEMBL53711</td>
<td>CN(C)c1cc2c(Nc3cccc(Br)c3)ncnc2cn1</td>
<td>11.221849</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7f90b904cca0&gt;</td>
<td>0.484375</td>
<td>0.327434</td>
<td>0.652632</td>
<td>0.493333</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_enrichment_data</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">similarity_measure</span><span class="p">,</span> <span class="n">pic50_cutoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Calculates x and y values for enrichment plot:</span>
<span class="sd">        x - % ranked dataset</span>
<span class="sd">        y - % true actives identified</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    molecules : pandas.DataFrame</span>
<span class="sd">        Molecules with similarity values to a query molecule.</span>
<span class="sd">    similarity_measure : str</span>
<span class="sd">        Column name which will be used to sort the DataFrame．</span>
<span class="sd">    pic50_cutoff : float</span>
<span class="sd">        pIC50 cutoff value used to discriminate active and inactive molecules.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Enrichment data: Percentage of ranked dataset by similarity vs. percentage of identified true actives.</span>
<span class="sd">    """</span>

    <span class="c1"># Get number of molecules in data set</span>
    <span class="n">molecules_all</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span>

    <span class="c1"># Get number of active molecules in data set</span>
    <span class="n">actives_all</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="s2">"pIC50"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pic50_cutoff</span><span class="p">)</span>

    <span class="c1"># Initialize a list that will hold the counter for actives and molecules while iterating through our dataset</span>
    <span class="n">actives_counter_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Initialize counter for actives</span>
    <span class="n">actives_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Note: Data must be ranked for enrichment plots:</span>
    <span class="c1"># Sort molecules by selected similarity measure</span>
    <span class="n">molecules</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">similarity_measure</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Iterate over the ranked dataset and check each molecule if active (by checking bioactivity)</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">[</span><span class="s2">"pIC50"</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">pic50_cutoff</span><span class="p">:</span>
            <span class="n">actives_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">actives_counter_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actives_counter</span><span class="p">)</span>

    <span class="c1"># Transform number of molecules into % ranked dataset</span>
    <span class="n">molecules_percentage_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="n">molecules_all</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">molecules_all</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Transform number of actives into % true actives identified</span>
    <span class="n">actives_percentage_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="n">actives_all</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">actives_counter_list</span><span class="p">]</span>

    <span class="c1"># Generate DataFrame with x and y values as well as label</span>
    <span class="n">enrichment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">"</span><span class="si">% r</span><span class="s2">anked dataset"</span><span class="p">:</span> <span class="n">molecules_percentage_list</span><span class="p">,</span>
            <span class="s2">"% true actives identified"</span><span class="p">:</span> <span class="n">actives_percentage_list</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">enrichment</span>
</pre></div>
</div>
</div>
<p>Set the pIC50 cutoff used to discriminate active and inactive molecules…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pic50_cutoff</span> <span class="o">=</span> <span class="mf">6.3</span>
</pre></div>
</div>
</div>
<p>…and get the enrichment for MACCS and Morgan fingerprints (using the Tanimoto similarity).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">similarity_measures</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"tanimoto_maccs"</span><span class="p">,</span> <span class="s2">"tanimoto_morgan"</span><span class="p">]</span>
<span class="n">enrichment_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">similarity_measure</span><span class="p">:</span> <span class="n">get_enrichment_data</span><span class="p">(</span><span class="n">molecule_dataset</span><span class="p">,</span> <span class="n">similarity_measure</span><span class="p">,</span> <span class="n">pic50_cutoff</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">similarity_measure</span> <span class="ow">in</span> <span class="n">similarity_measures</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Show example enrichment data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">enrichment_data</span><span class="p">[</span><span class="s2">"tanimoto_maccs"</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>% ranked dataset</th>
<th>% true actives identified</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0.000216</td>
<td>0.00038</td>
</tr>
<tr>
<th>1</th>
<td>0.000431</td>
<td>0.00038</td>
</tr>
<tr>
<th>2</th>
<td>0.000647</td>
<td>0.00076</td>
</tr>
<tr>
<th>3</th>
<td>0.000863</td>
<td>0.00114</td>
</tr>
<tr>
<th>4</th>
<td>0.001079</td>
<td>0.00152</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>Plot the enrichment data next to the optimal and random enrichment curve!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># Plot enrichment data</span>
<span class="k">for</span> <span class="n">similarity_measure</span><span class="p">,</span> <span class="n">enrichment</span> <span class="ow">in</span> <span class="n">enrichment_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">enrichment</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">"</span><span class="si">% r</span><span class="s2">anked dataset"</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">"% true actives identified"</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">similarity_measure</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"% True actives identified"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"% Ranked dataset"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

<span class="c1"># Plot optimal curve: Ratio of actives in dataset</span>
<span class="n">ratio_actives</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">molecule_dataset</span><span class="p">[</span><span class="s2">"pIC50"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pic50_cutoff</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule_dataset</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ratio_actives</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">"Optimal curve"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">"--"</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot random curve</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Random curve"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"--"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">"MACCS"</span><span class="p">,</span> <span class="s2">"Morgan"</span><span class="p">,</span> <span class="s2">"Optimal"</span><span class="p">,</span> <span class="s2">"Random"</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
    <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Save plot -- use bbox_inches to include text boxes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">DATA</span> <span class="o">/</span> <span class="s2">"enrichment_plot.png"</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">"tight"</span><span class="p">,</span>
    <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T004_compound_similarity_121_0.png" src="../_images/talktorials_T004_compound_similarity_121_0.png"/>
</div>
</div>
<p>The enrichment plots show a slightly better performance for fingerprint comparison based on Morgan fingerprints than based on MACCS fingerprints.</p>
</section>
<section id="Calculate-enrichment-factors">
<h4 id="Calculate-enrichment-factors">Calculate enrichment factors<a class="headerlink" href="#Calculate-enrichment-factors" title="Permalink to this heading">¶</a></h4>
<p>The (experimental) <strong>enrichment factor (EF)</strong> is used to access a methods success by a single number rather than a plot. The idea is to determine the percentage of active molecules in the top x% (e.g. 5%) of ranked molecules, as defined by the following helper function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_enrichment_factor</span><span class="p">(</span><span class="n">enrichment</span><span class="p">,</span> <span class="n">ranked_dataset_percentage_cutoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the experimental enrichment factor for a given percentage of the ranked dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    enrichment : pd.DataFrame</span>
<span class="sd">        Enrichment data: Percentage of ranked dataset by similarity vs. percentage of</span>
<span class="sd">        identified true actives.</span>
<span class="sd">    ranked_dataset_percentage_cutoff : float or int</span>
<span class="sd">        Percentage of ranked dataset to be included in enrichment factor calculation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Experimental enrichment factor.</span>
<span class="sd">    """</span>

    <span class="c1"># Keep only molecules that meet the cutoff</span>
    <span class="n">enrichment</span> <span class="o">=</span> <span class="n">enrichment</span><span class="p">[</span>
        <span class="n">enrichment</span><span class="p">[</span><span class="s2">"</span><span class="si">% r</span><span class="s2">anked dataset"</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ranked_dataset_percentage_cutoff</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="p">]</span>
    <span class="c1"># Get highest percentage of actives and the corresponding percentage of actives</span>
    <span class="n">highest_enrichment</span> <span class="o">=</span> <span class="n">enrichment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">enrichment_factor</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">highest_enrichment</span><span class="p">[</span><span class="s2">"% true actives identified"</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">enrichment_factor</span>
</pre></div>
</div>
</div>
<p>This helper function calculates the random enrichment of active molecules in the top x% of ranked molecules (<strong>random enrichment factor</strong>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_enrichment_factor_random</span><span class="p">(</span><span class="n">ranked_dataset_percentage_cutoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the random enrichment factor for a given percentage of the ranked dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ranked_dataset_percentage_cutoff : float or int</span>
<span class="sd">        Percentage of ranked dataset to be included in enrichment factor calculation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Random enrichment factor.</span>
<span class="sd">    """</span>

    <span class="n">enrichment_factor_random</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ranked_dataset_percentage_cutoff</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">enrichment_factor_random</span>
</pre></div>
</div>
</div>
<p>And this helper function calculates the optimal enrichment of active molecules in the top x% of ranked molecules (<strong>optimal enrichment factor</strong>). The random and optimal enrichment factors are needed to judge how good the experimental enrichment factor for a method is.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_enrichment_factor_optimal</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">ranked_dataset_percentage_cutoff</span><span class="p">,</span> <span class="n">pic50_cutoff</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the optimal random enrichment factor for a given percentage of the ranked dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    molecules : pandas.DataFrame</span>
<span class="sd">        the DataFrame with all the molecules and pIC50.</span>
<span class="sd">    ranked_dataset_percentage_cutoff : float or int</span>
<span class="sd">        Percentage of ranked dataset to be included in enrichment factor calculation.</span>
<span class="sd">    activity_cutoff: float</span>
<span class="sd">        pIC50 cutoff value used to discriminate active and inactive molecules</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Optimal enrichment factor.</span>
<span class="sd">    """</span>

    <span class="n">ratio</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="s2">"pIC50"</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pic50_cutoff</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="n">ranked_dataset_percentage_cutoff</span> <span class="o">&lt;=</span> <span class="n">ratio</span><span class="p">:</span>
        <span class="n">enrichment_factor_optimal</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">/</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">ranked_dataset_percentage_cutoff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">enrichment_factor_optimal</span> <span class="o">=</span> <span class="mf">100.0</span>
    <span class="k">return</span> <span class="n">enrichment_factor_optimal</span>
</pre></div>
</div>
</div>
<p>We are ready to calculate the experimental enrichment factor (EF) for 5% of ranked dataset…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ranked_dataset_percentage_cutoff</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">similarity_measure</span><span class="p">,</span> <span class="n">enrichment</span> <span class="ow">in</span> <span class="n">enrichment_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">enrichment_factor</span> <span class="o">=</span> <span class="n">calculate_enrichment_factor</span><span class="p">(</span><span class="n">enrichment</span><span class="p">,</span> <span class="n">ranked_dataset_percentage_cutoff</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Experimental EF for </span><span class="si">{</span><span class="n">ranked_dataset_percentage_cutoff</span><span class="si">}</span><span class="s2">% of ranked dataset (</span><span class="si">{</span><span class="n">similarity_measure</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">enrichment_factor</span><span class="si">}</span><span class="s2">%"</span>
    <span class="p">)</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Experimental EF for 5% of ranked dataset (tanimoto_maccs): 7.2%
Experimental EF for 5% of ranked dataset (tanimoto_morgan): 7.8%
</pre></div></div>
</div>
<p>… and we can compare it to the random and optimal enrichment factor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">enrichment_factor_random</span> <span class="o">=</span> <span class="n">calculate_enrichment_factor_random</span><span class="p">(</span><span class="n">ranked_dataset_percentage_cutoff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">"Random EF for </span><span class="si">{</span><span class="n">ranked_dataset_percentage_cutoff</span><span class="si">}</span><span class="s2">% of ranked dataset: </span><span class="si">{</span><span class="n">enrichment_factor_random</span><span class="si">}</span><span class="s2">%"</span>
<span class="p">)</span>
<span class="n">enrichment_factor_optimal</span> <span class="o">=</span> <span class="n">calculate_enrichment_factor_optimal</span><span class="p">(</span>
    <span class="n">molecule_dataset</span><span class="p">,</span> <span class="n">ranked_dataset_percentage_cutoff</span><span class="p">,</span> <span class="n">pic50_cutoff</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">"Optimal EF for </span><span class="si">{</span><span class="n">ranked_dataset_percentage_cutoff</span><span class="si">}</span><span class="s2">% of ranked dataset: </span><span class="si">{</span><span class="n">enrichment_factor_optimal</span><span class="si">}</span><span class="s2">%"</span>
<span class="p">)</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Random EF for 5% of ranked dataset: 5.0%
Optimal EF for 5% of ranked dataset: 8.8%
</pre></div></div>
</div>
</section>
</section>
</section>
<section id="Discussion">
<h2 id="Discussion">Discussion<a class="headerlink" href="#Discussion" title="Permalink to this heading">¶</a></h2>
<p>We have learned how to use fingerprints and similarity measures to compare a query molecule with a dataset of molecules and rank the molecule by similarity. This approach is an example for virtual screening of molecules. Enrichment plots and enrichment factors can be used to assess the performance.</p>
<p>A drawback of a similarity search with molecular fingerprints is that it is based on molecular similarity and thus does not yield any novel structures. Another challenge when working with molecular similarity are so-called activity cliffs, i.e. a small change in a functional group of a molecule may initiate a jump in bioactivity.</p>
</section>
<section id="Quiz">
<h2 id="Quiz">Quiz<a class="headerlink" href="#Quiz" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>What could be a starting point to circumvent activity cliffs?</p></li>
<li><p>What are the advantages and disadvantages of MACCS and Morgan fingerprints compared to each other fingerprints?</p></li>
<li><p>How can you explain the different orders in the similarity dataframe depending on the fingerprint used?</p></li>
</ul>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="T003_compound_unwanted_substructures.html" title="T003 · Molecular filtering: unwanted substructures"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> T003 · Molecular filtering: unwanted substructures </span>
              </div>
            </a>
          
          
            <a href="T005_compound_clustering.html" title="T005 · Compound clustering"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> T005 · Compound clustering </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2018-2023, Volkamer Lab. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.1.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>