<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="T006 · Maximum common substructure" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://projects.volkamerlab.org/teachopencadd/talktorials/T006_compound_maximum_common_substructures.html" />
<meta property="og:site_name" content="TeachOpenCADD" />
<meta property="og:description" content="Note: This talktorial is a part of TeachOpenCADD, a platform that aims to teach domain-specific skills and to provide pipeline templates as starting points for research projects. Authors: Oliver Nagel, CADD Seminars, 2017, Charité/FU Berlin, Jaime Rodríguez-Guerra, 2019-2020, Volkamer lab, Charit..." />
<meta property="og:image" content="https://raw.githubusercontent.com/volkamerlab/teachopencadd/master/docs/_static/images/TeachOpenCADD_topics.png" />
<meta property="og:image:alt" content="TeachOpenCADD" />
<meta name="description" content="Note: This talktorial is a part of TeachOpenCADD, a platform that aims to teach domain-specific skills and to provide pipeline templates as starting points for research projects. Authors: Oliver Nagel, CADD Seminars, 2017, Charité/FU Berlin, Jaime Rodríguez-Guerra, 2019-2020, Volkamer lab, Charit..." />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#2196f3">
  <script src="../_static/javascripts/modernizr.js"></script>
  
    <script async src="../_static/cookieconsent.min.js"></script>
    <script>
        window.addEventListener("load", function(){
        window.cookieconsent.initialise({
            "palette": {
            "popup": {
                "background": "#f0f0f0",
                "text": "#999"
            },
            "button": {
                "text": "#fff",
                "background": "#009688"
            }
            },
            "theme": "classic"
        })});
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q6ZE82CNZB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Q6ZE82CNZB');
    </script>
  
    <link rel="apple-touch-icon" href="../_static/images/apple-icon-152x152.png"/>
  
  
    <title>T006 · Maximum common substructure &#8212; TeachOpenCADD 0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="T007 · Ligand-based screening: machine learning" href="T007_compound_activity_machine_learning.html" />
    <link rel="prev" title="T005 · Compound clustering" href="T005_compound_clustering.html" />
  
    <link rel="apple-touch-icon" href="../_static/images/apple-icon-152x152.png"/>
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=teal data-md-color-accent=cyan>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#talktorials/T006_compound_maximum_common_substructures" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="TeachOpenCADD 0 documentation"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">TeachOpenCADD</span>
          <span class="md-header-nav__topic"> T006 · Maximum common substructure </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/volkamerlab/teachopencadd/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    TeachOpenCADD
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../talktorials.html" class="md-tabs__link">Our talktorials</a></li>
            
            <li class="md-tabs__item"><a href="../installing.html" class="md-tabs__link">Run locally</a></li>
            
            <li class="md-tabs__item"><a href="../contribute.html" class="md-tabs__link">Development</a></li>
            
            <li class="md-tabs__item"><a href="../contact.html" class="md-tabs__link">Contact</a></li>
            
            <li class="md-tabs__item"><a href="../citation.html" class="md-tabs__link">Citation</a></li>
          <li class="md-tabs__item"><a href="../all_talktorials.html" class="md-tabs__link">Complete list of talktorials</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="TeachOpenCADD 0 documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    <a href="../index.html"
       title="TeachOpenCADD 0 documentation">TeachOpenCADD</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/volkamerlab/teachopencadd/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    TeachOpenCADD
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Our talktorials</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../all_talktorials.html" class="md-nav__link">Complete list of talktorials</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="T001_query_chembl.html" class="md-nav__link">T001 · Compound data acquisition (ChEMBL)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T002_compound_adme.html" class="md-nav__link">T002 · Molecular filtering: ADME and lead-likeness criteria</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T003_compound_unwanted_substructures.html" class="md-nav__link">T003 · Molecular filtering: unwanted substructures</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T004_compound_similarity.html" class="md-nav__link">T004 · Ligand-based screening: compound similarity</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T005_compound_clustering.html" class="md-nav__link">T005 · Compound clustering</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> T006 · Maximum common substructure </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">T006 · Maximum common substructure</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#talktorials-t006-compound-maximum-common-substructures--page-root" class="md-nav__link">T006 · Maximum common substructure</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Aim-of-this-talktorial" class="md-nav__link">Aim of this talktorial</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Contents-in-Theory" class="md-nav__link">Contents in <em>Theory</em></a>
        </li>
        <li class="md-nav__item"><a href="#Contents-in-Practical" class="md-nav__link">Contents in <em>Practical</em></a>
        </li>
        <li class="md-nav__item"><a href="#References" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Theory" class="md-nav__link">Theory</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Introduction-to-identification-of-maximum-common-substructure-in-a-set-of-molecules" class="md-nav__link">Introduction to identification of maximum common substructure in a set of molecules</a>
        </li>
        <li class="md-nav__item"><a href="#Detailed-explanation-of-FMCS-algorithm" class="md-nav__link">Detailed explanation of FMCS algorithm</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#The-simplified-algorithm-description" class="md-nav__link">The simplified algorithm description</a>
        </li>
        <li class="md-nav__item"><a href="#Tricks-to-speed-up-the-run-time" class="md-nav__link">Tricks to speed up the run time</a>
        </li>
        <li class="md-nav__item"><a href="#A)-Bond-elimination" class="md-nav__link">A) Bond elimination</a>
        </li>
        <li class="md-nav__item"><a href="#B)-Use-the-structure-with-the-smallest-largest-fragment-as-the-query" class="md-nav__link">B) Use the structure with the smallest largest fragment as the query</a>
        </li>
        <li class="md-nav__item"><a href="#C)-Use-a-breadth-first-search-(BFS)-and-a-priority-queue-to-enumerate-the-fragment-subgraphs" class="md-nav__link">C) Use a breadth-first search (BFS) and a priority queue to enumerate the fragment subgraphs</a>
        </li>
        <li class="md-nav__item"><a href="#D)-Prune-seeds-not-present-in-all-of-the-other-structures" class="md-nav__link">D) Prune seeds not present in all of the other structures</a>
        </li>
        <li class="md-nav__item"><a href="#E)-Prune-seeds-without-sufficient-growing-potential" class="md-nav__link">E) Prune seeds without sufficient growing potential</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Practical" class="md-nav__link">Practical</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Load-and-draw-molecules" class="md-nav__link">Load and draw molecules</a>
        </li>
        <li class="md-nav__item"><a href="#Run-the-FMCS-algorithm-with-different-input-parameters" class="md-nav__link">Run the FMCS algorithm with different input parameters</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Default-values" class="md-nav__link">Default values</a>
        </li>
        <li class="md-nav__item"><a href="#Set-a-threshold" class="md-nav__link">Set a threshold</a>
        </li>
        <li class="md-nav__item"><a href="#Match-ring-bonds" class="md-nav__link">Match ring bonds</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#A-more-diverse-set:-the-EGFR-compounds-downloaded-from-ChEMBL" class="md-nav__link">A more diverse set: the EGFR compounds downloaded from ChEMBL</a>
        </li>
        <li class="md-nav__item"><a href="#Identification-of-MCS-using-interactive-cut-off-adaption" class="md-nav__link">Identification of MCS using interactive cut-off adaption</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Discussion" class="md-nav__link">Discussion</a>
        </li>
        <li class="md-nav__item"><a href="#Quiz" class="md-nav__link">Quiz</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/talktorials/T006_compound_maximum_common_substructures.nblink.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T007_compound_activity_machine_learning.html" class="md-nav__link">T007 · Ligand-based screening: machine learning</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T008_query_pdb.html" class="md-nav__link">T008 · Protein data acquisition: Protein Data Bank (PDB)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T009_compound_ensemble_pharmacophores.html" class="md-nav__link">T009 · Ligand-based pharmacophores</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T010_binding_site_comparison.html" class="md-nav__link">T010 · Binding site similarity and off-target prediction</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T011_query_online_api_webservices.html" class="md-nav__link">T011 · Querying online API webservices</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T012_query_klifs.html" class="md-nav__link">T012 · Data acquisition from KLIFS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T013_query_pubchem.html" class="md-nav__link">T013 · Data acquisition from PubChem</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T014_binding_site_detection.html" class="md-nav__link">T014 · Binding site detection</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T015_protein_ligand_docking.html" class="md-nav__link">T015 · Protein ligand docking</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T016_protein_ligand_interactions.html" class="md-nav__link">T016 · Protein-ligand interactions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T017_advanced_nglview_usage.html" class="md-nav__link">T017 · Advanced NGLview usage</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T018_automated_cadd_pipeline.html" class="md-nav__link">T018 · Automated pipeline for lead optimization</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T019_md_simulation.html" class="md-nav__link">T019 · Molecular dynamics simulation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T020_md_analysis.html" class="md-nav__link">T020 · Analyzing molecular dynamics simulations</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T021_one_hot_encoding.html" class="md-nav__link">T021 · One-Hot Encoding</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T022_ligand_based_screening_neural_network.html" class="md-nav__link">T022 · Ligand-based screening: neural networks</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T023_what_is_a_kinase.html" class="md-nav__link">T023 · What is a kinase?</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T024_kinase_similarity_sequence.html" class="md-nav__link">T024 · Kinase similarity: Sequence</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T025_kinase_similarity_kissim.html" class="md-nav__link">T025 · Kinase similarity: Kinase pocket (KiSSim fingerprint)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T026_kinase_similarity_ifp.html" class="md-nav__link">T026 · Kinase similarity: Interaction fingerprints</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T027_kinase_similarity_ligand_profile.html" class="md-nav__link">T027 · Kinase similarity: Ligand profile</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T028_kinase_similarity_compare_perspectives.html" class="md-nav__link">T028 · Kinase similarity: Compare different perspectives</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html" class="md-nav__link">Talktorials by collection</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Run locally</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installing.html" class="md-nav__link">Installing</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Development</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../contribute.html" class="md-nav__link">For contributors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../api.html" class="md-nav__link">API Documentation</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">About TeachOpenCADD</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../contact.html" class="md-nav__link">Contact</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../acknowledgments.html" class="md-nav__link">Acknowledgments</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../citation.html" class="md-nav__link">Citation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../license.html" class="md-nav__link">License</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../funding.html" class="md-nav__link">Funding</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">External resources</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../external_dependencies.html" class="md-nav__link">Packages and webservers used in TeachOpenCADD</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../external_tutorials_collections.html" class="md-nav__link">External tutorials and collections</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#talktorials-t006-compound-maximum-common-substructures--page-root" class="md-nav__link">T006 · Maximum common substructure</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Aim-of-this-talktorial" class="md-nav__link">Aim of this talktorial</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Contents-in-Theory" class="md-nav__link">Contents in <em>Theory</em></a>
        </li>
        <li class="md-nav__item"><a href="#Contents-in-Practical" class="md-nav__link">Contents in <em>Practical</em></a>
        </li>
        <li class="md-nav__item"><a href="#References" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Theory" class="md-nav__link">Theory</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Introduction-to-identification-of-maximum-common-substructure-in-a-set-of-molecules" class="md-nav__link">Introduction to identification of maximum common substructure in a set of molecules</a>
        </li>
        <li class="md-nav__item"><a href="#Detailed-explanation-of-FMCS-algorithm" class="md-nav__link">Detailed explanation of FMCS algorithm</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#The-simplified-algorithm-description" class="md-nav__link">The simplified algorithm description</a>
        </li>
        <li class="md-nav__item"><a href="#Tricks-to-speed-up-the-run-time" class="md-nav__link">Tricks to speed up the run time</a>
        </li>
        <li class="md-nav__item"><a href="#A)-Bond-elimination" class="md-nav__link">A) Bond elimination</a>
        </li>
        <li class="md-nav__item"><a href="#B)-Use-the-structure-with-the-smallest-largest-fragment-as-the-query" class="md-nav__link">B) Use the structure with the smallest largest fragment as the query</a>
        </li>
        <li class="md-nav__item"><a href="#C)-Use-a-breadth-first-search-(BFS)-and-a-priority-queue-to-enumerate-the-fragment-subgraphs" class="md-nav__link">C) Use a breadth-first search (BFS) and a priority queue to enumerate the fragment subgraphs</a>
        </li>
        <li class="md-nav__item"><a href="#D)-Prune-seeds-not-present-in-all-of-the-other-structures" class="md-nav__link">D) Prune seeds not present in all of the other structures</a>
        </li>
        <li class="md-nav__item"><a href="#E)-Prune-seeds-without-sufficient-growing-potential" class="md-nav__link">E) Prune seeds without sufficient growing potential</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Practical" class="md-nav__link">Practical</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Load-and-draw-molecules" class="md-nav__link">Load and draw molecules</a>
        </li>
        <li class="md-nav__item"><a href="#Run-the-FMCS-algorithm-with-different-input-parameters" class="md-nav__link">Run the FMCS algorithm with different input parameters</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Default-values" class="md-nav__link">Default values</a>
        </li>
        <li class="md-nav__item"><a href="#Set-a-threshold" class="md-nav__link">Set a threshold</a>
        </li>
        <li class="md-nav__item"><a href="#Match-ring-bonds" class="md-nav__link">Match ring bonds</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#A-more-diverse-set:-the-EGFR-compounds-downloaded-from-ChEMBL" class="md-nav__link">A more diverse set: the EGFR compounds downloaded from ChEMBL</a>
        </li>
        <li class="md-nav__item"><a href="#Identification-of-MCS-using-interactive-cut-off-adaption" class="md-nav__link">Identification of MCS using interactive cut-off adaption</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Discussion" class="md-nav__link">Discussion</a>
        </li>
        <li class="md-nav__item"><a href="#Quiz" class="md-nav__link">Quiz</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/talktorials/T006_compound_maximum_common_substructures.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="T006-·-Maximum-common-substructure">
<h1 id="talktorials-t006-compound-maximum-common-substructures--page-root">T006 · Maximum common substructure<a class="headerlink" href="#talktorials-t006-compound-maximum-common-substructures--page-root" title="Permalink to this heading">¶</a></h1>
<p><strong>Note:</strong> This talktorial is a part of TeachOpenCADD, a platform that aims to teach domain-specific skills and to provide pipeline templates as starting points for research projects.</p>
<p>Authors:</p>
<ul class="simple">
<li><p>Oliver Nagel, CADD Seminars, 2017, Charité/FU Berlin</p></li>
<li><p>Jaime Rodríguez-Guerra, 2019-2020, <a class="reference external" href="https://volkamerlab.org">Volkamer lab</a>, Charité</p></li>
<li><p>Andrea Volkamer, 2019-2020, <a class="reference external" href="https://volkamerlab.org">Volkamer lab</a>, Charité</p></li>
</ul>
<p><strong>Talktorial T006</strong>: This talktorial is part of the TeachOpenCADD pipeline described in the <a class="reference external" href="https://jcheminf.biomedcentral.com/articles/10.1186/s13321-019-0351-x">first TeachOpenCADD paper</a>, comprising talktorials T001-T010.</p>
<section id="Aim-of-this-talktorial">
<h2 id="Aim-of-this-talktorial">Aim of this talktorial<a class="headerlink" href="#Aim-of-this-talktorial" title="Permalink to this heading">¶</a></h2>
<p>Clustering and classification of large scale chemical data is essential for navigation, analysis and knowledge discovery in a wide variety of chemical application domains in drug discovery.</p>
<p>In the last talktorial, we learned how to group molecules (clustering) and found that the molecules in one cluster look similar to each other and share a common scaffold. Besides visual inspection, we will learn here how to calculate the maximum substructure that a set of molecules has in common.</p>
<section id="Contents-in-Theory">
<h3 id="Contents-in-Theory">Contents in <em>Theory</em><a class="headerlink" href="#Contents-in-Theory" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Introduction to identification of maximum common substructure in a set of molecules</p></li>
<li><p>Detailed explanation of the FMCS algorithm</p></li>
</ul>
</section>
<section id="Contents-in-Practical">
<h3 id="Contents-in-Practical">Contents in <em>Practical</em><a class="headerlink" href="#Contents-in-Practical" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Load and draw molecules</p></li>
<li><p>Run the FMCS algorithm with different input parameters</p></li>
<li><p>A more diverse set: the EGFR compounds downloaded from ChEMBL</p></li>
<li><p>Identification of MCS using interactive cut-off adaption</p></li>
</ul>
</section>
<section id="References">
<h3 id="References">References<a class="headerlink" href="#References" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Dalke A, Hastings J., FMCS: a novel algorithm for the multiple MCS problem. <a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3606201/">J. Cheminf. 2013; 5 (Suppl 1): O6</a></p></li>
<li><p>Raymond JW., Willet P., Maximum common subgraph isomorphism algorithms for the matching of chemical structures. <a class="reference external" href="https://link.springer.com/article/10.1023/A:1021271615909">J Comput Aided Mol Des. 2002 Jul; 16(7):521-33</a></p></li>
<li><p><a class="reference external" href="http://dalkescientific.com/writings/diary/archive/2012/05/12/mcs_background.html">Dalke’s website with info on algorithm</a></p></li>
<li><p><a class="reference external" href="http://www.rdkit.org/docs/Cookbook.html#using-custom-mcs-atom-types">RDKit Cookbook documentation on MCS</a></p></li>
</ul>
</section>
</section>
<section id="Theory">
<h2 id="Theory">Theory<a class="headerlink" href="#Theory" title="Permalink to this heading">¶</a></h2>
<section id="Introduction-to-identification-of-maximum-common-substructure-in-a-set-of-molecules">
<h3 id="Introduction-to-identification-of-maximum-common-substructure-in-a-set-of-molecules">Introduction to identification of maximum common substructure in a set of molecules<a class="headerlink" href="#Introduction-to-identification-of-maximum-common-substructure-in-a-set-of-molecules" title="Permalink to this heading">¶</a></h3>
<img alt="Maximum common substructure, highlighted" src="../_images/mymols.png"/>
<p>The maximum common structure (MCS) is defined as the largest substructure that appears in two or more candidate molecules.</p>
<ul class="simple">
<li><p>Finding the MCS = maximum common subgraph isomorphism problem</p></li>
<li><p>Has many applications in the field of cheminformatics: similarity search, hierarchical clustering, or molecule alignment</p></li>
<li><p>Advantages:</p>
<ul>
<li><p>Intuitive <span class="math notranslate nohighlight">\(\rightarrow\)</span> shared structure among candidates likely to be important</p></li>
<li><p>Provides insight into possible activity patterns</p></li>
<li><p>Easy visualization by simply highlighting the substructure</p></li>
</ul>
</li>
</ul>
<p>Details on MCS algorithms (see review: <a class="reference external" href="https://link.springer.com/article/10.1023/A:1021271615909">J Comput Aided Mol Des. 2002 Jul; 16(7):521-33</a>)</p>
<ul class="simple">
<li><p>Determining an MCS between two or more graphs is an NP-complete problem</p></li>
<li><p>Algorithms for exact determination as well as approximations exist</p>
<ul>
<li><p>Exact: Maximum-clique, backtracking, dynamic programming</p></li>
<li><p>Approximate: Genetic algorithm, combinatorial optimization, fragment storage, …</p></li>
<li><p>Problem reduction: Simplify the molecular graphs</p></li>
</ul>
</li>
</ul>
<p>Example of an implementation: <a class="reference external" href="http://dalkescientific.com/writings/diary/archive/2012/05/12/mcs_background.html">FMCS</a> algorithm</p>
<ul class="simple">
<li><p>Models MCS problem as a graph isomorphism problem</p></li>
<li><p>Based on subgraph enumeration and subgraph isomorphism testing</p></li>
</ul>
</section>
<section id="Detailed-explanation-of-FMCS-algorithm">
<h3 id="Detailed-explanation-of-FMCS-algorithm">Detailed explanation of FMCS algorithm<a class="headerlink" href="#Detailed-explanation-of-FMCS-algorithm" title="Permalink to this heading">¶</a></h3>
<p>As explained in <a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3606201/">J. Cheminf. 2013; 5(Suppl 1): O6</a> and the respective <a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.fmcs.fmcs.html">RDKit FMCS documentation</a>.</p>
<section id="The-simplified-algorithm-description">
<h4 id="The-simplified-algorithm-description">The simplified algorithm description<a class="headerlink" href="#The-simplified-algorithm-description" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>best_substructure = None
pick one structure in the set as query, all other as targets
for each substructure in the query:
    convert into a SMARTS string based on the desired match properties
    if SMARTS pattern exists in all of the targets:
        then it is a common substructure
        keep track of the maximum of such substructure
</pre></div>
</div>
<p>This simple approach alone will usually take a long time, but there are certain tricks used to speed up the run time.</p>
</section>
<section id="Tricks-to-speed-up-the-run-time">
<h4 id="Tricks-to-speed-up-the-run-time">Tricks to speed up the run time<a class="headerlink" href="#Tricks-to-speed-up-the-run-time" title="Permalink to this heading">¶</a></h4>
<p><img alt="d18c099949234130b4d7240763151f7e" class="no-scaled-link" src="../_images/speed_tricks.jpg" style="width: 800px;"/></p>
</section>
<section id="A)-Bond-elimination">
<h4 id="A)-Bond-elimination">A) Bond elimination<a class="headerlink" href="#A)-Bond-elimination" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Remove bonds that cannot be part of the MCS</p></li>
<li><p>Atom and bond type information has to be present in every input structure</p></li>
<li><p>Bond type: string consisting of SMARTS of the first atom, the bond and the second atom</p></li>
<li><p>Exclude all bond types not present in all input structures, delete respective edges</p></li>
<li><p>Result: fragmented structures with all atom information, but fewer edges (bonds)</p></li>
</ul>
</section>
<section id="B)-Use-the-structure-with-the-smallest-largest-fragment-as-the-query">
<h4 id="B)-Use-the-structure-with-the-smallest-largest-fragment-as-the-query">B) Use the structure with the smallest largest fragment as the query<a class="headerlink" href="#B)-Use-the-structure-with-the-smallest-largest-fragment-as-the-query" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Heuristic approach:</p>
<ul>
<li><p>Find largest fragment of each input structure</p></li>
<li><p>Sort input structures ascending by number of bonds in largest fragment</p></li>
<li><p>Solve ties with number of atoms or input order as alternative</p></li>
</ul>
</li>
<li><p>The structure with the smallest largest fragment becomes the query structure</p></li>
<li><p>The ones from the other input structures are the targets</p></li>
</ul>
</section>
<section id="C)-Use-a-breadth-first-search-(BFS)-and-a-priority-queue-to-enumerate-the-fragment-subgraphs">
<h4 id="C)-Use-a-breadth-first-search-(BFS)-and-a-priority-queue-to-enumerate-the-fragment-subgraphs">C) Use a breadth-first search (BFS) and a priority queue to enumerate the fragment subgraphs<a class="headerlink" href="#C)-Use-a-breadth-first-search-(BFS)-and-a-priority-queue-to-enumerate-the-fragment-subgraphs" title="Permalink to this heading">¶</a></h4>
<p><strong>C1</strong> * Enumeration based on growing a so called seed * Seed: atoms/bonds in current subgraph, exclusion set (bonds not applicable for growth) * To prevent redundancy: * Initial seed is first bond in the fragment, can potentially grow to size of whole fragment * Second seed is second bond, is excluded from using the first bond * Third seed starts from the third bond, excluded from using the first and second * …</p>
<p><strong>C2</strong> * Seed grows along connected bonds (not in exclusions set or already in seed) * All growing possibilities are considered at every step * E.g. if there are N possible bonds for extension, <span class="math notranslate nohighlight">\(2^{N-1}\)</span> possible new seeds are added to queue * Enumeration ends when there are no new bonds to add to subgraph (exclude seed from queue) * Largest seed will be processed first</p>
</section>
<section id="D)-Prune-seeds-not-present-in-all-of-the-other-structures">
<h4 id="D)-Prune-seeds-not-present-in-all-of-the-other-structures">D) Prune seeds not present in all of the other structures<a class="headerlink" href="#D)-Prune-seeds-not-present-in-all-of-the-other-structures" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>At each growth state <span class="math notranslate nohighlight">\(\rightarrow\)</span> check if new seed exists in all other structures</p></li>
<li><p>Else: Exclude seed from queue</p></li>
</ul>
</section>
<section id="E)-Prune-seeds-without-sufficient-growing-potential">
<h4 id="E)-Prune-seeds-without-sufficient-growing-potential">E) Prune seeds without sufficient growing potential<a class="headerlink" href="#E)-Prune-seeds-without-sufficient-growing-potential" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Evaluation of growth potential from exclusion list and possible edges for extension</p></li>
<li><p>If potential smaller than current best subgraph <span class="math notranslate nohighlight">\(\rightarrow\)</span> exclude seed from queue</p></li>
</ul>
<p>Utilizing these approaches it is then trivial to keep track of the largest subgraph which corresponds to the maximum common substructure.</p>
</section>
</section>
</section>
<section id="Practical">
<h2 id="Practical">Practical<a class="headerlink" href="#Practical" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">widgets</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">Geometry</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">AllChem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">Draw</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">rdFMCS</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">PandasTools</span>

<span class="kn">from</span> <span class="nn">teachopencadd.utils</span> <span class="kn">import</span> <span class="n">seed_everything</span>

<span class="n">seed_everything</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HERE</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">_dh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="n">HERE</span> <span class="o">/</span> <span class="s2">"data"</span>
</pre></div>
</div>
</div>
<section id="Load-and-draw-molecules">
<h3 id="Load-and-draw-molecules">Load and draw molecules<a class="headerlink" href="#Load-and-draw-molecules" title="Permalink to this heading">¶</a></h3>
<p>Cluster data taken from <strong>Talktorial T005</strong> or later EGFR molecules from <strong>Talktorial T001</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">HERE</span> <span class="o">/</span> <span class="s2">"../T005_compound_clustering/data/molecule_set_largest_cluster.sdf"</span><span class="p">)</span>
<span class="n">supplier</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">ForwardSDMolSupplier</span><span class="p">(</span><span class="n">sdf</span><span class="p">)</span>
<span class="n">mols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">supplier</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Set with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span><span class="si">}</span><span class="s2"> molecules loaded."</span><span class="p">)</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set with 145 molecules loaded.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show only first 10 molecules -- use slicing</span>
<span class="n">num_mols</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">legends</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">"_Name"</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]</span>
<span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span><span class="n">mols</span><span class="p">[:</span><span class="n">num_mols</span><span class="p">],</span> <span class="n">legends</span><span class="o">=</span><span class="n">legends</span><span class="p">[:</span><span class="n">num_mols</span><span class="p">],</span> <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_16_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_16_0.png"/>
</div>
</div>
</section>
<section id="Run-the-FMCS-algorithm-with-different-input-parameters">
<h3 id="Run-the-FMCS-algorithm-with-different-input-parameters">Run the FMCS algorithm with different input parameters<a class="headerlink" href="#Run-the-FMCS-algorithm-with-different-input-parameters" title="Permalink to this heading">¶</a></h3>
<p>The FMCS algorithm is implemented in RDKit: <a class="reference external" href="https://rdkit.org/docs/source/rdkit.Chem.rdFMCS.html">rdFMCS</a></p>
<section id="Default-values">
<h4 id="Default-values">Default values<a class="headerlink" href="#Default-values" title="Permalink to this heading">¶</a></h4>
<p>In the simplest case only a list of molecules is given as a parameter.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mcs1</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"MCS1 contains </span><span class="si">{</span><span class="n">mcs1</span><span class="o">.</span><span class="n">numAtoms</span><span class="si">}</span><span class="s2"> atoms and </span><span class="si">{</span><span class="n">mcs1</span><span class="o">.</span><span class="n">numBonds</span><span class="si">}</span><span class="s2"> bonds."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"MCS SMARTS string:"</span><span class="p">,</span> <span class="n">mcs1</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MCS1 contains 24 atoms and 26 bonds.
MCS SMARTS string: [#6]-[#6](=[#8])-[#7]-[#6]1:[#6]:[#6]2:[#6](-[#7]-[#6]3:[#6]:[#6]:[#6]:[#6]:[#6]:3):[#7]:[#6]:[#7]:[#6]:2:[#6]:[#6]:1-[#8]-[#6]-[#6]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw substructure from Smarts</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs1</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="n">Draw</span><span class="o">.</span><span class="n">MolToImage</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">"MCS1"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_20_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_20_0.png"/>
</div>
</div>
<p>Define a helper function to draw the molecules with the highlighted MCS.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">highlight_molecules</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">mcs</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">same_orientation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Highlight the MCS in our query molecules"""</span>
    <span class="n">molecules</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span>
    <span class="c1"># convert MCS to molecule</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
    <span class="c1"># find the matching atoms in each molecule</span>
    <span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">molecule</span><span class="o">.</span><span class="n">GetSubstructMatch</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">[:</span><span class="n">number</span><span class="p">]]</span>

    <span class="n">legends</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">legends</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">"_Name"</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">]</span>

    <span class="c1"># Align by matched substructure so they are depicted in the same orientation</span>
    <span class="c1"># Adapted from: https://gist.github.com/greglandrum/82d9a86acb3b00d3bb1df502779a5810</span>
    <span class="k">if</span> <span class="n">same_orientation</span><span class="p">:</span>
        <span class="n">mol</span><span class="p">,</span> <span class="n">match</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">matching</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">()</span><span class="o">.</span><span class="n">GetAtomPosition</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">match</span><span class="p">]</span>
        <span class="n">coords2D</span> <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point2D</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mol</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">number</span><span class="p">],</span> <span class="n">matching</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">number</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">coord_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">match</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">coord</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords2D</span><span class="p">)}</span>
            <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">coordMap</span><span class="o">=</span><span class="n">coord_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
        <span class="n">molecules</span><span class="p">[:</span><span class="n">number</span><span class="p">],</span>
        <span class="n">legends</span><span class="o">=</span><span class="n">legends</span><span class="p">,</span>
        <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">highlightAtomLists</span><span class="o">=</span><span class="n">matching</span><span class="p">[:</span><span class="n">number</span><span class="p">],</span>
        <span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">highlight_molecules</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">mcs1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_23_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_23_0.png"/>
</div>
</div>
<p>Save image to disk</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">highlight_molecules</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">mcs1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">useSVG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Get SVG data</span>
<span class="n">molsvg</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># Set background to transparent &amp; Enlarge size of label</span>
<span class="n">molsvg</span> <span class="o">=</span> <span class="n">molsvg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"opacity:1.0"</span><span class="p">,</span> <span class="s2">"opacity:0.0"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"12px"</span><span class="p">,</span> <span class="s2">"20px"</span><span class="p">)</span>

<span class="c1"># Save altered SVG data to file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="s2">"mcs_largest_cluster.svg"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">molsvg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Set-a-threshold">
<h4 id="Set-a-threshold">Set a threshold<a class="headerlink" href="#Set-a-threshold" title="Permalink to this heading">¶</a></h4>
<p>It is possible to lower the threshold for the substructure, for example so that the MCS only has to occur in e.g. 80% of the input structures.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mcs2</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"MCS2 contains </span><span class="si">{</span><span class="n">mcs2</span><span class="o">.</span><span class="n">numAtoms</span><span class="si">}</span><span class="s2"> atoms and </span><span class="si">{</span><span class="n">mcs2</span><span class="o">.</span><span class="n">numBonds</span><span class="si">}</span><span class="s2"> bonds."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"SMARTS string:"</span><span class="p">,</span> <span class="n">mcs2</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MCS2 contains 28 atoms and 30 bonds.
SMARTS string: [#6]=[#6]-[#6](=[#8])-[#7]-[#6]1:[#6]:[#6]2:[#6](-[#7]-[#6]3:[#6]:[#6]:[#6]:[#6]:[#6]:3-[#9]):[#7]:[#6]:[#7]:[#6]:2:[#6]:[#6]:1-[#8]-[#6]-[#6]-[#7]-[#6]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw substructure</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs2</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">([</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span> <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="s2">"MCS1"</span><span class="p">,</span> <span class="s2">"MCS2: +threshold=0.8"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_28_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_28_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">highlight_molecules</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">mcs2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_29_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_29_0.png"/>
</div>
</div>
<!-- FIXME: CI - CHEMBL27685 id is not in this subset, check that T005 produces deterministic outputs --><p>As we can see in this example, some molecules were now left out due to the set threshold (<code class="docutils literal notranslate"><span class="pre">0.8</span></code>). This threshold allows to find a larger common substructure that contains, e.g., a benzene with a meta-substitution fluor pattern and a longer alkane chain.</p>
</section>
<section id="Match-ring-bonds">
<h4 id="Match-ring-bonds">Match ring bonds<a class="headerlink" href="#Match-ring-bonds" title="Permalink to this heading">¶</a></h4>
<p>In the above example it may not be obvious, but by default ring bonds can match non-ring bonds. Often from an application point of view, we want to retain rings. Thus, one can set the <code class="docutils literal notranslate"><span class="pre">ringMatchesRingOnly</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then only ring bonds match with other ring bonds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mcs3</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">ringMatchesRingOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"MCS3 contains </span><span class="si">{</span><span class="n">mcs3</span><span class="o">.</span><span class="n">numAtoms</span><span class="si">}</span><span class="s2"> atoms and </span><span class="si">{</span><span class="n">mcs3</span><span class="o">.</span><span class="n">numBonds</span><span class="si">}</span><span class="s2"> bonds."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"SMARTS string:"</span><span class="p">,</span> <span class="n">mcs3</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MCS3 contains 28 atoms and 30 bonds.
SMARTS string: [#6&amp;!R]=&amp;!@[#6&amp;!R]-&amp;!@[#6&amp;!R](=&amp;!@[#8&amp;!R])-&amp;!@[#7&amp;!R]-&amp;!@[#6&amp;R]1:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]2:&amp;@[#6&amp;R](-&amp;!@[#7&amp;!R]-&amp;!@[#6&amp;R]3:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@3-&amp;!@[#9&amp;!R]):&amp;@[#7&amp;R]:&amp;@[#6&amp;R]:&amp;@[#7&amp;R]:&amp;@[#6&amp;R]:&amp;@2:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@1-&amp;!@[#8&amp;!R]-&amp;!@[#6&amp;!R]-&amp;!@[#6&amp;!R]-&amp;!@[#7&amp;!R]-&amp;!@[#6&amp;!R]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw substructure</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs3</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">([</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">],</span> <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="s2">"MCS1"</span><span class="p">,</span> <span class="s2">"MCS2: +treshold=0.8"</span><span class="p">,</span> <span class="s2">"mcs3: +ringmatch"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_33_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_33_0.png"/>
</div>
</div>
<p>We can see here that depending on the chosen thresholds and parameters, we get slightly different MCS. Note that there are more parameter options available in the <a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#maximum-common-substructure">RDKit FMCS module</a>, e.g. considering atom, bond or valence matching.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">highlight_molecules</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">mcs3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_35_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_35_0.png"/>
</div>
</div>
</section>
</section>
<section id="A-more-diverse-set:-the-EGFR-compounds-downloaded-from-ChEMBL">
<h3 id="A-more-diverse-set:-the-EGFR-compounds-downloaded-from-ChEMBL">A more diverse set: the EGFR compounds downloaded from ChEMBL<a class="headerlink" href="#A-more-diverse-set:-the-EGFR-compounds-downloaded-from-ChEMBL" title="Permalink to this heading">¶</a></h3>
<p>We restrict the data to only highly active molecules (pIC50&gt;9) and detect the maximum common scaffold in this subset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read full EGFR data</span>
<span class="n">mol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">HERE</span> <span class="o">/</span> <span class="s2">"../T001_query_chembl/data/EGFR_compounds.csv"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Total number of compounds:"</span><span class="p">,</span> <span class="n">mol_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Only keep molecules with pIC50 &gt; 9 (IC50 &gt; 1nM)</span>
<span class="n">mol_df</span> <span class="o">=</span> <span class="n">mol_df</span><span class="p">[</span><span class="n">mol_df</span><span class="o">.</span><span class="n">pIC50</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Number of compounds with pIC50 &gt; 9:"</span><span class="p">,</span> <span class="n">mol_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total number of compounds: 5568
Number of compounds with pIC50 &gt; 9: 186
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add molecule column to data frame</span>
<span class="n">PandasTools</span><span class="o">.</span><span class="n">AddMoleculeColumnToFrame</span><span class="p">(</span><span class="n">mol_df</span><span class="p">,</span> <span class="s2">"smiles"</span><span class="p">)</span>
<span class="n">mol_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>molecule_chembl_id</th>
<th>IC50</th>
<th>units</th>
<th>smiles</th>
<th>pIC50</th>
<th>ROMol</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>CHEMBL63786</td>
<td>0.003</td>
<td>nM</td>
<td>Brc1cccc(Nc2ncnc3cc4ccccc4cc23)c1</td>
<td>11.522879</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7fa686666ca0&gt;</td>
</tr>
<tr>
<th>1</th>
<td>CHEMBL35820</td>
<td>0.006</td>
<td>nM</td>
<td>CCOc1cc2ncnc(Nc3cccc(Br)c3)c2cc1OCC</td>
<td>11.221849</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7fa686666c40&gt;</td>
</tr>
<tr>
<th>2</th>
<td>CHEMBL53711</td>
<td>0.006</td>
<td>nM</td>
<td>CN(C)c1cc2c(Nc3cccc(Br)c3)ncnc2cn1</td>
<td>11.221849</td>
<td>&lt;rdkit.Chem.rdchem.Mol object at 0x7fa686666be0&gt;</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>We do our calculations on the selected highly active molecules only.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mols_diverse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Note: discarded variables we do not care about are usually referred to with a single underscore</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mol_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">smiles</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="s2">"_Name"</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">molecule_chembl_id</span><span class="p">)</span>
    <span class="n">mols_diverse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In the interest of time, we randomly pick 50 molecules from this set.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We have fixed the random seed above (imports) for deterministic results</span>
<span class="n">mols_diverse_sample</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">mols_diverse</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We now calculate the same three variants of MCSs as described above and draw the respective substructures. We use a slightly lower threshold to account for the larger diversity in the set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold_diverse</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">mcs1</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols_diverse_sample</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"SMARTS string1:"</span><span class="p">,</span> <span class="n">mcs1</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="n">mcs2</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols_diverse_sample</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold_diverse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"SMARTS string2:"</span><span class="p">,</span> <span class="n">mcs2</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="n">mcs3</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols_diverse_sample</span><span class="p">,</span> <span class="n">ringMatchesRingOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold_diverse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"SMARTS string3:"</span><span class="p">,</span> <span class="n">mcs3</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="c1"># NBVAL_CHECK_OUTPUT</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SMARTS string1: [#6](:,-[#6]-,:[#7]-,:[#6]1:[#6]:[#6]:[#6]:[#6]:[#6]:1):,-[#6]:,-[#7]:,-[#6]
SMARTS string2: [#6]:[#6]:[#6]1:[#6](-[#7]-[#6]2:[#6]:[#6]:[#6]:[#6]:[#6]:2):[#7]:[#6]:[#7]:[#6]:1:[#6]
SMARTS string3: [#6&amp;R]:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]1:&amp;@[#6&amp;R](-&amp;!@[#7&amp;!R]-&amp;!@[#6&amp;R]2:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@[#6&amp;R]:&amp;@2):&amp;@[#7&amp;R]:&amp;@[#6&amp;R]:&amp;@[#7&amp;R]:&amp;@[#6&amp;R]:&amp;@1:&amp;@[#6&amp;R]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw substructures</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs1</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs2</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs3</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>

<span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="p">[</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">],</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">"MCS1"</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">"MCS2: +threshold=</span><span class="si">{</span><span class="n">threshold_diverse</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"MCS3: +ringmatch"</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_45_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_45_0.png"/>
</div>
</div>
<p>This time it become more clear that setting <code class="docutils literal notranslate"><span class="pre">ringMatchesRingOnly=True</span></code> provides a more intuitive representation of the scaffold they share.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">highlight_molecules</span><span class="p">(</span><span class="n">mols_diverse_sample</span><span class="p">,</span> <span class="n">mcs3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T006_compound_maximum_common_substructures_47_0.png" src="../_images/talktorials_T006_compound_maximum_common_substructures_47_0.png"/>
</div>
</div>
</section>
<section id="Identification-of-MCS-using-interactive-cut-off-adaption">
<h3 id="Identification-of-MCS-using-interactive-cut-off-adaption">Identification of MCS using interactive cut-off adaption<a class="headerlink" href="#Identification-of-MCS-using-interactive-cut-off-adaption" title="Permalink to this heading">¶</a></h3>
<p>We can also change the threshold interactively. For that, we need a helper function, hereby defined. It takes two arguments: <code class="docutils literal notranslate"><span class="pre">molecules</span></code> (fixed, so it’s not configurable with a widget) and <code class="docutils literal notranslate"><span class="pre">percentage</span></code> (the value of which is determined by the interactive widget). Every time you modify the state of the slider, this helper function is called.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">render_mcs</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">percentage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Interactive widget helper. `molecules` must be wrapped in `ipywidgets.fixed()`,</span>
<span class="sd">    while `percentage` will be determined by an IntSlider widget."""</span>
    <span class="n">tmcs</span> <span class="o">=</span> <span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">percentage</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tmcs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No MCS found"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">tmcs</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tmcs</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that the slider may take a few seconds to react</span>
<span class="n">interact</span><span class="p">(</span>
    <span class="n">render_mcs</span><span class="p">,</span>
    <span class="n">molecules</span><span class="o">=</span><span class="n">fixed</span><span class="p">(</span><span class="n">mols_diverse_sample</span><span class="p">),</span>
    <span class="n">percentage</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">70</span><span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ce945e276b6147c7b2686bab33fc40f2", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
</section>
<section id="Discussion">
<h2 id="Discussion">Discussion<a class="headerlink" href="#Discussion" title="Permalink to this heading">¶</a></h2>
<p>Maximum substructures that a set of molecules have in common can a useful strategy to visualize common scaffolds. In this talktorial, we have use the FMCS algorithm to find the maximum common substructure within a largest cluster from <strong>Talktorial T005</strong>. An interactive widget allowed us to explore the impact of different thresholds on the maximum common substructure in our dataset.</p>
</section>
<section id="Quiz">
<h2 id="Quiz">Quiz<a class="headerlink" href="#Quiz" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Why is the calculation of the maximum common substructure (MCS) useful?</p></li>
<li><p>Can you briefly describe how an MCS can be calculated?</p></li>
<li><p>How does the typical fragment of an active EGFR compound look like?</p></li>
</ul>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="T005_compound_clustering.html" title="T005 · Compound clustering"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> T005 · Compound clustering </span>
              </div>
            </a>
          
          
            <a href="T007_compound_activity_machine_learning.html" title="T007 · Ligand-based screening: machine learning"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> T007 · Ligand-based screening: machine learning </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2018-2023, Volkamer Lab. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.1.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>